{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "3218e2b0-1bcc-46d4-affa-d298e0cf90f6",
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "üîé Guide",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": []
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "id": "d7afa921-907e-4c42-87ca-e67aecd47310"
          },
          {
            "id": "e6ded9a1-a83c-4762-938d-5bf8ff3d3d38",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "e3225ed0-6210-40a1-b2d0-66e42ffa71d6",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| order by name asc\r\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\r\n| mvexpand All limit 100\r\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "15b2c181-7397-43c1-900a-28e175ae8a6f",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "‚è±Ô∏è Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Attack",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]",
            "label": "üü• Attack",
            "id": "36236e98-fe09-4e2a-a808-8d481cfbe8de"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Defend",
            "label": "üü¶ Defend",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\", \"selected\":true},\r\n    {\"value\": \"No\", \"label\": \"No\"}\r\n]",
            "id": "719e2c8c-aa52-4419-97c1-8a55255dc6cb"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Tactics",
            "label": "üü® Tactics",
            "type": 2,
            "isRequired": true,
            "query": "SecurityAlert\r\n| where Tactics == \"InitialAccess\" or Tactics == \"Execution\" or Tactics == \"Persistence\" or Tactics == \"PrivilegeEscalation\" or Tactics == \"DefenseEvasion\" or Tactics == \"CredentialAccess\" or Tactics == \"Discovery\" or Tactics == \"LateralMovement\" or Tactics == \"Collection\" or Tactics == \"Exfiltration\" or Tactics == \"Impact\"\r\n| summarize count() by Tactics\r\n| sort by count_ desc\r\n| project-away count_",
            "value": "InitialAccess",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "id": "616e8081-8d88-4baa-ab4b-d39a761f97a7"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Product",
            "label": "üü© Products",
            "type": 2,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| summarize count() by ProviderName\r\n| join SecurityProducts on ProviderName\r\n| project Product, count_\r\n| sort by count_ desc\r\n| project-away count_",
            "crossComponentResources": [
              "{Workspace}"
            ],
            "value": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "id": "3121daa3-b39a-44d0-abe5-96bd91db8853"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Parameter Selectors"
    },
    {
      "type": 1,
      "content": {
        "json": "<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Please take time to answer a quick survey,\r\n</span>[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> click here. </span>](https://forms.office.com/r/UjQS9t0TSr)"
      },
      "name": "Survey"
    },
    {
      "type": 1,
      "content": {
        "json": "# Threat Analysis & Response for Cloud\n\nThis solution enables SecOps Analysts, Threat Intelligence Professional, and Threat Hunters to gain situational awareness for threats in cloud environment. This solution is designed to augment staffing through automation, artificial intelligence, machine learning, alert generation, and visualizations. Threat modeling is an advanced cybersecurity discipline requiring detailed knowledge of identifying and acting on the attacker based on observation of indicators in various stages of the attack cycle. This offering provides granular situational awareness across the MITRE ATT&CK¬Æ for Cloud Matrix including 75+ Tactic/Technique cards demonstrating a red versus blue approach to threat modeling. This offering augments the advanced cybersecurity skillsets required for threat modeling and provides actionable insights across 25+ Microsoft products. \n\nATT&CK is a globally accessible knowledge base of adversary tactics and techniques based on real-world observations. The ATT&CK knowledge base is used as a foundation for the development of specific threat models and methodologies in the private sector, in government, and in the cybersecurity product and service community. The ATT&CK Cloud Matrix provides tactics and techniques representing the ATT&CK Matrix for Enterprise covering cloud-based techniques. The Matrix contains information for the following platforms: Azure AD, Office 365, Google Workspace, SaaS, IaaS. For more information, see the üí° [ATT&CK: Cloud Matrix](https://attack.mitre.org/matrices/enterprise/cloud/).\n\n <br>\n<br>\n1Ô∏è‚É£  Onboard üí°[Azure Sentinel](https://docs.microsoft.com/azure/sentinel/quickstart-onboard)<br>\n2Ô∏è‚É£  Deploy üí°[Azure Sentinel: Threat Analysis & Response Solution](https://portal.azure.com/#create/azuresentinel.azure-sentinel-solution-mitreattck)<br>\n3Ô∏è‚É£  Access Threat Analysis & Response Workbook for Analytics/Hunting Configuration Guidance<br>\n4Ô∏è‚É£  Leverage the Threat Analysis & Response Notebook for custom Heat Mapping of MITRE ATT&CK Tactics & Techniques<br>\n5Ô∏è‚É£  Leverage the Threat Analysis & Response: Cloud Matrix for a Red (Attack) versus Blue (Defense) perspective for threat detection and mitigation<br>"
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "customWidth": "75",
      "name": "text - 2",
      "styleSettings": {
        "maxWidth": "75"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "![Image Name](https://azure.microsoft.com/svghandler/azure-sentinel?width=600&height=315) "
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "customWidth": "21",
      "name": "Azure Sentinel Logo"
    },
    {
      "type": 1,
      "content": {
        "json": "# ‚ú≥Ô∏è [MITRE ATT&CK Cloud Matrix](https://attack.mitre.org/matrices/enterprise/cloud/)\r\n----------------------------------------------------------------------------------------------------"
      },
      "name": "text - 30"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"initial\"\n| summarize count()\n\n\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Initial Access",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Initial Access",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"execution\"\n| summarize count()",
        "size": 4,
        "showAnalytics": true,
        "title": "Execution",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Execution",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"persistence\"\n| summarize count()\n\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Persistence",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Persistence",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"privilege\"\n| summarize count()\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Privilege Escalation",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Privilege Escalation",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"defense\"\n| summarize count()\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Defense Evasion",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Defense Evasion",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"credential\"\n| summarize count()\n\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Credential Access",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Credential Access",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"discovery\"\n| summarize count()\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Discovery",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Discovery",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"lateral\"\n| summarize count()\n\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Lateral Movement",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Lateral Movement",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"collection\"\n| summarize count()\n\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Collection",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Collection",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"exfil\"\n| summarize count()\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Exfiltration",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Exfiltration",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\n[\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\n    \"MCAS\", \"Microsoft Cloud App Security\",\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\n    \"Azure Security Center\", \"Azure Security Center\",\n    \"Detection-WarmPathV2\", \"Azure Defender\",\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\n    \"IPC\", \"Azure Active Directory Identity Protection\",\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\n    \"IoTSecurity\", \"Azure Defender for IoT\",\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\n    \"OATP\", \"Microsoft Defender for Office 365\",\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\n];\nSecurityAlert\n| join kind=inner SecurityProducts on ProviderName\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\n| where Tactics contains \"impact\"\n| summarize count()\n\n",
        "size": 4,
        "showAnalytics": true,
        "title": "Impact",
        "timeContext": {
          "durationMs": 2592000000
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "visualization": "tiles",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Description",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "60%"
              }
            },
            {
              "columnMatch": "name",
              "formatter": 0,
              "formatOptions": {
                "customColumnWidthSetting": "5%"
              }
            },
            {
              "columnMatch": "severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "critical",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "Major",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ],
                "customColumnWidthSetting": "5"
              }
            },
            {
              "columnMatch": "message",
              "formatter": 7,
              "formatOptions": {
                "linkTarget": "CellDetails",
                "linkIsContextBlade": true,
                "customColumnWidthSetting": "70%"
              }
            }
          ]
        },
        "sortBy": [],
        "tileSettings": {
          "titleContent": {
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "count_",
            "formatter": 8,
            "formatOptions": {
              "min": 0,
              "max": 100,
              "palette": "yellowOrangeRed"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "useGrouping": false,
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "9",
      "name": "Impact",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Initial Access](https://attack.mitre.org/tactics/TA0001/) \r\n---\r\nThe adversary is trying to get into your network. Initial Access consists of techniques that use various entry vectors to gain their initial foothold within a network. Techniques used to gain a foothold include targeted spearphishing and exploiting weaknesses on public-facing web servers. Footholds gained through initial access may allow for continued access, like valid accounts and use of external remote services, or may be limited-use due to changing passwords."
            },
            "customWidth": "45",
            "name": "text - 7"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 8"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "44e941a2-9148-4ebe-bb72-0b1269c2aa05",
                  "cellValue": "Initial Access Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "af33f331-b64b-4fbd-a0b4-3e411ff705a8",
                  "cellValue": "Drive-by Compromise",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Drive-by Compromise",
                  "style": "link"
                },
                {
                  "id": "cca4d1e8-e1e2-4b1d-9b8a-698e6496924c",
                  "cellValue": "Exploit Public-Facing Application",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Exploit Public-Facing Application",
                  "style": "link"
                },
                {
                  "id": "f7074cad-e2ec-4a2c-84d1-7b33b14d4c04",
                  "cellValue": "Phishing",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Phishing",
                  "style": "link"
                },
                {
                  "id": "35bfb771-67e1-480a-ac96-0a59f2c8dbc2",
                  "cellValue": "Trusted Relationship",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Trusted Relationship",
                  "style": "link"
                },
                {
                  "id": "525509b1-980b-45d1-94d3-4efaa66b911a",
                  "cellValue": "Valid Accounts",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Valid Accounts",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Initial Access Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"initial\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èInitial Access Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èInitial Access Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"initial\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èInitial Access Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èInitial Access Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Initial Access Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Drive-by Compromise (T1189)](https://attack.mitre.org/techniques/T1189)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [W3CIISLog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/w3ciislog) ‚ú≥Ô∏è [Virtual Machines]( https://azure.microsoft.com/services/virtual-machines/)<br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) ‚ú≥Ô∏è [Application Gateway]( https://azure.microsoft.com/services/application-gateway/)<br>\r\n\r\n### Mitigations\r\nüü¶ [Application Isolation and Sandboxing (M1048)](https://attack.mitre.org/mitigations/M1048)<br> \r\nüü¶ [Exploit Protection (M1050)](https://attack.mitre.org/mitigations/M1050)<br> \r\nüü¶ [Restrict Web-Based Content (M1021)](https://attack.mitre.org/mitigations/M1021)<br> \r\nüü¶ [Update Software (M1051)](https://attack.mitre.org/mitigations/M1051)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Application Isolation and Sandboxing) Leverage Microsoft Defender Application Guard](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-application-guard/md-app-guard-overview)<br> \r\nüí° [(Exploit Protection) Create and Deploy an Exploit Guard Policy](https://docs.microsoft.com/mem/configmgr/protect/deploy-use/create-deploy-exploit-guard-policy)<br> \r\nüí° [(Restrict Web-Based Content) Deploy Azure Firewall](https://docs.microsoft.com/azure/firewall/tutorial-firewall-deploy-portal-policy)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Azure Web Application Firewall](https://docs.microsoft.com/azure/web-application-firewall/ag/application-gateway-web-application-firewall-portal)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Microsoft Defender for Endpoint](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/deployment-phases)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Azure Application Gateway](https://docs.microsoft.com/azure/application-gateway/quick-create-portal)<br>\r\nüí° [(Update Software) Leverage Azure Automation Accounts for Updates/Patching](https://docs.microsoft.com/azure/automation/update-management/enable-from-portals)<br>\r\nüí° [(Update Software) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\nüîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview) <br>\r\nüîÄ [Web Application Firewall Policies](https://portal.azure.com/#blade/Microsoft_Azure_Network/LoadBalancingHubMenuBlade/loadBalancers)  <br> \r\nüîÄ [Application Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br>  üîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br> \r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"script\" or AlertName contains \"web\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èMalicious Scripts & Web Attacks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èMalicious Scripts & Web Attacks",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Application Isolation and Sandboxing) Leverage Microsoft Defender Application Guard\r\n![ImageName](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-application-guard/images/appguard-hardware-isolation.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Defender for Endpoint]( https://www.microsoft.com/microsoft-365/security/endpoint-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 11",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Exploit Protection) Create and Deploy an Exploit Guard Policy\r\n![ImageName](https://cloudblogs.microsoft.com/uploads/prod/2018/01/windows-defender-exploit-guard-11-2.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Defender for Endpoint]( https://www.microsoft.com/microsoft-365/security/endpoint-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 11",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Category\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict Web-Based Content) Azure Firewall + Azure WAF + Azure Application Gateway: Web Filtering",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Update Software) Leverage Azure Automation Accounts for Updates/Patching\r\n![ImageName](https://docs.microsoft.com/azure/automation/update-management/media/overview/update-mgmt-updateworkflow.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Azure Automation]( https://azure.microsoft.com/services/automation/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 11",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"agent should be installed\"\r\nor RecommendationDisplayName contains \"agent health\"\r\nor RecommendationDisplayName contains \"update\"\r\nor RecommendationDisplayName contains \"upgrade\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Update Software) Azure Security Center Recommendations for Updates",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Update Software) Azure Security Center Recommendations for Updates"
                }
              ]
            },
            "name": "Drive-by Compromise",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Exploit Public-Facing Application (T1190)](https://attack.mitre.org/techniques/T1190/)\r\n\r\n### Recommended Logs \r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) <br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>üî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>  üî∑ [W3CIISLog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/w3ciislog) ‚ú≥Ô∏è [Virtual Machines](https://azure.microsoft.com/services/virtual-machines/)<br>\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Application Isolation and Sandboxing (M1048)](https://attack.mitre.org/mitigations/M1048)<br> \r\nüü¶ [Exploit Protection (M1050)](https://attack.mitre.org/mitigations/M1050)<br> \r\nüü¶ [Network Segmentation (M1030)](https://attack.mitre.org/mitigations/M1030)<br> \r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br> \r\nüü¶ [Restrict Web-Based Content (M1021)](https://attack.mitre.org/mitigations/M1021)<br> \r\nüü¶ [Update Software (M1051)](https://attack.mitre.org/mitigations/M1051)<br> \r\nüü¶ [Vulnerability Scanning (M1016)](https://attack.mitre.org/mitigations/M1016)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Application Isolation and Sandboxing) Leverage Microsoft Defender Application Guard](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-application-guard/md-app-guard-overview)<br> \r\nüí° [(Exploit Protection) Create and Deploy an Exploit Guard Policy](https://docs.microsoft.com/mem/configmgr/protect/deploy-use/create-deploy-exploit-guard-policy)<br> \r\nüí° [(Network Segmentation) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br> \r\nüí° [(Restrict Web-Based Content) Deploy Azure Web Application Firewall](https://docs.microsoft.com/azure/web-application-firewall/ag/application-gateway-web-application-firewall-portal)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Microsoft Defender for Endpoint](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/deployment-phases)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Azure Application Gateway](https://docs.microsoft.com/azure/application-gateway/quick-create-portal)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Azure Web Application Firewall](https://docs.microsoft.com/azure/web-application-firewall/ag/application-gateway-web-application-firewall-portal)<br>\r\nüí° [(Update Software) Leverage Azure Automation Accounts for Updates/Patching](https://docs.microsoft.com/azure/automation/update-management/enable-from-portals)<br>\r\nüí° [(Update Software) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Vulnerability Scanning) Deploy Azure Security Center for Integrated Vulnerability Assessments](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br> \r\nüí° [(Vulnerability Scanning) Deploy Microsoft Defender for Endpoint for Threat Vulnerability Management](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/next-gen-threat-and-vuln-mgt)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> \r\nüîÄ [Microsoft Cloud App Security Portal](https://portal.cloudappsecurity.com/)<br>\r\nüîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br> \r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> \r\nüîÄ [Web Application Firewall Policies](https://portal.azure.com/#blade/Microsoft_Azure_Network/LoadBalancingHubMenuBlade/loadBalancers)  <br> \r\nüîÄ [Application Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br> \r\nüîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview) <br> \r\nüîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br>\r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart) <br> \r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> \r\nüîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"app\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCloud Application Attacks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èCloud Application Attacks",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Network Segmentation) with Azure Virtual Networks\r\n![Image¬†Name](https://docs.microsoft.com/azure/architecture/framework/security/images/hub-and-spoke.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Virtual Network]( https://azure.microsoft.com/services/virtual-network/) "
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 10",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Network Segmentation) Implement Microsegmentation \r\n![Image¬†Name](https://docs.microsoft.com/azure/architecture/framework/security/images/ref-entp-design-az-network-security.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Virtual Network]( https://azure.microsoft.com/services/virtual-network/) \r\n‚ú≥Ô∏è [Get Started with Application Gateway](https://azure.microsoft.com/services/application-gateway/)\r\n‚ú≥Ô∏è [Get Started with Azure Firewall](https://azure.microsoft.com/services/azure-firewall/)\r\n‚ú≥Ô∏è [Get Started with Azure Web Application Firewall](https://azure.microsoft.com/services/web-application-firewall/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 10",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation \r\n| summarize count() by Description, AssessedResourceId, RecommendationSeverity\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation \r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by RecommendationSeverity\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center: Vulnerability Severity Over Time",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "VulnerabilityId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center: Vulnerability Severity Over Time",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"vuln\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center: Vulnerability Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Vulnerability Scanning) Azure Security Center: Vulnerability Recommendations"
                }
              ]
            },
            "name": "Exploit Public-Facing Application",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Phishing (T1566)](https://attack.mitre.org/techniques/T1566)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Spearphishing Attachment (T1566.001)](https://attack.mitre.org/techniques/T1566/001/) <br> \r\nüü• Ô∏è[Spearphishing Link (T1566.002)](https://attack.mitre.org/techniques/T1566/002/) <br> \r\nüü• Ô∏è[Spearphishing via Service (T1566.003)](https://attack.mitre.org/techniques/T1566/003/) <br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender) ‚ú≥Ô∏è [Microsoft Teams](https://www.microsoft.com/microsoft-teams/group-chat-software)<br>\r\n\r\n### Mitigations\r\nüü¶ [Antivirus/Antimalware (M1049)](https://attack.mitre.org/mitigations/M1049)<br>\r\nüü¶ [Network Intrusion Prevention (M1031)](https://attack.mitre.org/mitigations/M1031)<br>\r\nüü¶ [Restrict Web-Based Content (M1021)](https://attack.mitre.org/mitigations/M1021)<br> \r\nüü¶ [Software Configuration (M1054)](https://attack.mitre.org/mitigations/M1054)<br>\r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Antivirus/Antimalware) Configure Anti-Phishing Policies in Microsoft Defender for Office 365](https://docs.microsoft.com/microsoft-365/security/office-365-security/configure-mdo-anti-phishing-policies)<br> \r\nüí° [(Network Intrusion Prevention) Leverage Safe Attachments in Microsoft Defender for Office 365](https://docs.microsoft.com/microsoft-365/security/office-365-security/set-up-atp-safe-attachments-policies)<br> \r\nüí° [(Restrict Web-Based Content) Leverage Safe Links in Microsoft Defender for Office 365](https://docs.microsoft.com/microsoft-365/security/office-365-security/atp-safe-links)<br>\r\nüí° [(Software Configuration) Leverage Microsoft 365 & Microsoft 365 Defender for Email Security](https://docs.microsoft.com/microsoft-365/security/office-365-security/use-dmarc-to-validate-email)<br>\r\nüí° [(User Training) Leverage Microsoft Learn for Security Threat Training](https://docs.microsoft.com/learn/browse/?terms=security%20threat)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where ProviderName == \"OATP\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èPhishing (Microsoft Defender for Office 365)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èPhishing (Microsoft Defender for Office 365)",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Antivirus/Antimalware) Configure Anti-Phishing Policies in Microsoft Defender for Office 365\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/tp_emailprocessingineopt3.png)\r\n\r\n‚ú≥Ô∏è [Get Microsoft Defender for Office 365](https://www.microsoft.com/microsoft-365/security/office-365-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Network Intrusion Prevention) Leverage Safe Attachments in Microsoft Defender for Office 365\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/safe-docs.png)\r\n\r\n‚ú≥Ô∏è [Get Microsoft Defender for Office 365](https://www.microsoft.com/microsoft-365/security/office-365-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Restrict Web-Based Content) Leverage Safe Links in Microsoft Defender for Office 365\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/ee8dd5ed-6b91-4248-b054-12b719e8d0ed.png)\r\n\r\n‚ú≥Ô∏è [Get Microsoft Defender for Office 365](https://www.microsoft.com/microsoft-365/security/office-365-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Software Configuration) Leverage Microsoft 365 & Microsoft 365 Defender for Email Security\r\n![Image¬†Name](https://docs.microsoft.com/microsoft-365/media/tp_dmarctroublehoot.png)\r\n\r\n‚ú≥Ô∏è [Get Microsoft Defender for Office 365](https://www.microsoft.com/microsoft-365/security/office-365-defender)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (User Training) Leverage Microsoft Learn for Security Training\r\n![Image¬†Name](https://docs.microsoft.com/learn/modules/intro-to-security-in-azure/media/1-heading.png¬†¬†\"Microsoft Learn\")¬†\r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Learn](https://docs.microsoft.com/learn/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Phishing",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Trusted Relationship (T1199)](https://attack.mitre.org/techniques/T1199)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Network Segmentation (M1030)](https://attack.mitre.org/mitigations/M1030)<br> \r\nüü¶ [User Account Control (M1052)](https://attack.mitre.org/mitigations/M1052)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Network Segmentation) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\nüí° [(User Account Control) Azure Active Directory: Monitor Non-Organizational Account Sign-Ins](https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-all-sign-ins)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>   üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"user\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSuspect User Activity ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èSuspect User Activity ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "//Adjust !contains to your organization's mail domain\r\nSigninLogs\r\n| where UserPrincipalName contains \"@\" and UserPrincipalName !contains \"microsoft.com\"\r\n| summarize count() by UserPrincipalName, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Control) Azure Active Directory: Monitor Non-Organizational Account Sign-Ins",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"bound\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"net\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"load\"\r\nor RecommendationDisplayName contains \"address\"\r\nor RecommendationDisplayName contains \"public\"\r\nor RecommendationDisplayName contains \"private\"\r\nor RecommendationDisplayName contains \"VPC\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Network Segmentation) Azure Security Center Recommendations for Network Segmentation",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Network Segmentation) Azure Security Center Recommendations for Network Segmentation"
                }
              ]
            },
            "name": "Trusted Relationship",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Valid Accounts (T1078)](https://attack.mitre.org/techniques/T1078/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Default Accounts (T1078.001)](https://attack.mitre.org/techniques/T1078/001/)<br> \r\nüü• Ô∏è[Cloud Accounts (T1078.004)](https://attack.mitre.org/techniques/T1078/004/)\r\n\r\n###¬†Recommended¬†Logs\r\nüî∑ [Syslog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/syslog) ‚ú≥Ô∏è [Collect Syslog Data Sources with Log Analytics Agent](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-syslog) <br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>  üî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft 365 Defender](https://www.microsoft.com/microsoft-365/security/microsoft-365-defender)<br> \r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Multi-Factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br> \r\nüü¶ [Application Developer Guidance (M1013)](https://attack.mitre.org/mitigations/M1013)<br> \r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br> \r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br> \r\nüü¶ [Password Policies (M1027)](https://attack.mitre.org/mitigations/M1027)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Application Developer Guidance) Secure Identity with Zero Trust](https://docs.microsoft.com/security/zero-trust/identity)<br> \r\nüí° [(Application Developer Guidance) Secure Secrets with Azure Key Vault](https://docs.microsoft.com/azure/key-vault/general/basic-concepts)<br> \r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br> \r\nüí° [(Password Policies) Password and Account Lockout Policies on Azure Active Directory Domain Services Managed Domains](https://docs.microsoft.com/azure/active-directory-domain-services/password-policy#)<br> \r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>\r\nüîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br>\r\nüîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart) <br>    üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>\r\nüîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n| where AppDisplayName contains \"Portal\"\r\n// 50126 - Invalid username or password, or invalid on-premises username or password.\r\n// 50020? - The user doesn't exist in the tenant.\r\n| where ResultType in (\"50126\", \"50020\")\r\n| extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser\r\n| extend StatusCode = tostring(Status.errorCode), StatusDetails = tostring(Status.additionalDetails)\r\n| extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), IPAddresses = makeset(IPAddress), DistinctIPCount = dcount(IPAddress), \r\n    makeset(OS), makeset(Browser), makeset(City), AttemptCount = count() \r\n    by UserDisplayName, UserPrincipalName, AppDisplayName, ResultType, ResultDescription, StatusCode, StatusDetails, Location, State\r\n| extend timestamp = StartTimeUtc, AccountCustomEntity = UserPrincipalName\r\n| summarize count() by UserPrincipalName, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Failed Attempt to Access a Microsoft Portal (By Count)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èUser Failed Attempt to Access a Microsoft Portal (By Count)",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let azureSignIns = \r\n    SigninLogs\r\n    | where SourceSystem == \"Azure AD\"\r\n    | where OperationName == \"Sign-in activity\"\r\n    | project TimeGenerated, OperationName, AppDisplayName, Identity, UserId, UserPrincipalName, Location, LocationDetails, \r\n        ClientAppUsed, DeviceDetail, ConditionalAccessPolicies;\r\nazureSignIns\r\n| extend locationString = strcat(tostring(LocationDetails[\"countryOrRegion\"]), \"/\", \r\n    tostring(LocationDetails[\"state\"]), \"/\", tostring(LocationDetails[\"city\"]), \";\", tostring(LocationDetails[\"geoCoordinates\"]))\r\n| summarize rawSigninCount = count(), countByAccount = dcount(UserId), locationCount = dcount(locationString) by AppDisplayName\r\n// tail - pick a threshold to rule out the very-high volume Azure AD apps\r\n| where rawSigninCount < 1000\r\n// more locations than accounts\r\n| where locationCount > countByAccount\r\n// almost as many / more locations than sign-ins!\r\n| where 1.0 * rawSigninCount / locationCount > 0.8 \r\n| order by rawSigninCount desc\r\n| join kind = leftouter (\r\n    azureSignIns \r\n    )\r\n    on AppDisplayName \r\n| project AppDisplayName, TimeGenerated, Identity, rawSigninCount, countByAccount, locationCount,  \r\n    locationString = strcat(tostring(LocationDetails[\"countryOrRegion\"]), \"/\", tostring(LocationDetails[\"state\"]), \"/\", \r\n    tostring(LocationDetails[\"city\"]), \";\", tostring(LocationDetails[\"geoCoordinates\"])), UserPrincipalName\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = UserPrincipalName \r\n| order by AppDisplayName, TimeGenerated desc\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Identity\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous AAD Apps Based on Authentication Location (By User)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èAnomalous AAD Apps Based on Authentication Location (By User)",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let IP_Data = (externaldata(network: string)\r\n    [@\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/VPS_Networks.csv\"] with (format=\"csv\"));\r\nSigninLogs\r\n| where ResultType == 0\r\n| extend additionalDetails = tostring(Status.additionalDetails)\r\n| evaluate ipv4_lookup(IP_Data, IPAddress, network, return_unmatched = false)\r\n| summarize make_set(additionalDetails), min(TimeGenerated), max(TimeGenerated) by IPAddress, UserPrincipalName\r\n// Uncomment the remaining lines to only see logons from VPS providers with token only logons.\r\n//| where array_length(set_additionalDetails) == 2\r\n//| where (set_additionalDetails[1] == \"MFA requirement satisfied by claim in the token\" and set_additionalDetails[0] == \"MFA requirement satisfied by claim provided by external provider\") or (set_additionalDetails[0] == \"MFA requirement satisfied by claim in the token\" and set_additionalDetails[1] == \"MFA requirement satisfied by claim provided by external provider\")\r\n| extend timestamp = min_TimeGenerated, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress\r\n| summarize count() by UserPrincipalName, IPAddress\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Signins From Virtual Private Server Providers",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èUser Signins From Virtual Private Server Providers",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let action = dynamic([\"change \", \"changed \", \"reset \"]);\r\nlet pWord = dynamic([\"password \", \"credentials \"]);\r\n(union isfuzzy=true\r\n  (SecurityEvent\r\n| where EventID in (4723,4724)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ResultDescriptions = makeset(Activity), ActionCount = count() by Resource = Computer, OperationName = strcat(\"TargetAccount: \", TargetUserName), UserId = Account, Type\r\n),\r\n(AuditLogs\r\n| where OperationName has_any (pWord) and OperationName has_any (action)\r\n| extend InitiatedBy = tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName) \r\n| extend TargetUserPrincipalName = tostring(TargetResources[0].userPrincipalName) \r\n| where ResultDescription != \"None\" \r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ResultDescriptions = makeset(ResultDescription), CorrelationIds = makeset(CorrelationId), ActionCount = count() by OperationName = strcat(Category, \" - \", OperationName, \" - \", Result), Resource, UserId = TargetUserPrincipalName, Type\r\n| extend ResultDescriptions = tostring(ResultDescriptions)\r\n),\r\n(OfficeActivity\r\n| where (ExtendedProperties has_any (pWord) or ModifiedProperties has_any (pWord)) and (ExtendedProperties has_any (action) or ModifiedProperties has_any (action))\r\n| extend ResultDescriptions = case(\r\nOfficeWorkload =~ \"AzureActiveDirectory\", tostring(ExtendedProperties),\r\nOfficeWorkload has_any (\"Exchange\",\"OneDrive\"), OfficeObjectId,\r\nRecordType) \r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ResultDescriptions = makeset(ResultDescriptions), ActionCount = count() by Resource = OfficeWorkload, OperationName = strcat(Operation, \" - \", ResultStatus), IPAddress = ClientIP, UserId, Type\r\n),\r\n(Syslog\r\n| where SyslogMessage has_any (pWord) and SyslogMessage has_any (action)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ResultDescriptions = makeset(SyslogMessage), ActionCount = count() by Resource = HostName, OperationName = Facility , IPAddress = HostIP, ProcessName, Type\r\n),\r\n(SigninLogs\r\n| where OperationName =~ \"Sign-in activity\" and ResultType has_any (\"50125\", \"50133\")\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), ResultDescriptions = makeset(ResultDescription), CorrelationIds = makeset(CorrelationId), ActionCount = count() by Resource, OperationName = strcat(OperationName, \" - \", ResultType), IPAddress, UserId = UserPrincipalName, Type\r\n)\r\n)\r\n| extend timestamp = StartTimeUtc, AccountCustomEntity = UserId, IPCustomEntity = IPAddress\r\n| summarize count() by UserId\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• User Changes Passwords For Multiple Sources ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• User Changes Passwords For Multiple Sources",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics == \"InitialAccess\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èInitial Access Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èInitial Access Alerts",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Multi-Factor Authentication) Configure Multi Factor Authentication\r\n![Image¬†Name](https://docs.microsoft.com/azure/active-directory/authentication/media/tutorial-enable-azure-mfa/conditional-access-overview.png)¬†\r\n\r\n‚ú≥Ô∏è [Enable Azure Active Directory Premium Trial](https://azure.microsoft.com/trial/get-started-active-directory/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ (Multi-Factor Authentication: M1032) Configure Multi Factor Authentication",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let nonInteractive = AADNonInteractiveUserSignInLogs\r\n| extend LocationDetails = parse_json(LocationDetails)\r\n| extend Status = parse_json(Status);\r\nlet data = \r\nunion SigninLogs,nonInteractive\r\n|extend errorCode = Status.errorCode\r\n|extend SigninStatus = case(errorCode == 0, \"Success\", errorCode == 50058, \"Pending user action\",errorCode == 50140, \"Pending user action\", errorCode == 51006, \"Pending user action\", errorCode == 50059, \"Pending user action\",errorCode == 65001, \"Pending user action\", errorCode == 52004, \"Pending user action\", errorCode == 50055, \"Pending user action\", errorCode == 50144, \"Pending user action\", errorCode == 50072, \"Pending user action\", errorCode == 50074, \"Pending user action\", errorCode == 16000, \"Pending user action\", errorCode == 16001, \"Pending user action\", errorCode == 16003, \"Pending user action\", errorCode == 50127, \"Pending user action\", errorCode == 50125, \"Pending user action\", errorCode == 50129, \"Pending user action\", errorCode == 50143, \"Pending user action\", errorCode == 81010, \"Pending user action\", errorCode == 81014, \"Pending user action\", errorCode == 81012 ,\"Pending user action\", \"Failure\");\r\ndata\r\n| summarize Count = count() by SigninStatus\r\n| join kind = fullouter (datatable(SigninStatus:string)['Success', 'Pending action (Interrupts)', 'Failure']) on SigninStatus\r\n| project SigninStatus = iff(SigninStatus == '', SigninStatus1, SigninStatus), Count = iff(SigninStatus == '', 0, Count)\r\n| join kind = inner (data\r\n    | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by SigninStatus)\r\n    on SigninStatus\r\n| project-away SigninStatus1, TimeGenerated\r\n| extend Status = SigninStatus\r\n| union (\r\n    data \r\n    | summarize Count = count()\r\n    | extend jkey = 1\r\n    | join kind=inner (data\r\n        | make-series Trend = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain}\r\n        | extend jkey = 1) on jkey\r\n    | extend SigninStatus = 'All Sign-ins', Status = '*'    \r\n)\r\n| order by Count desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Multi-Factor Authentication) Monitor Authentications",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "SigninStatus",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Count",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "secondaryContent": {
                        "columnMatch": "Trend",
                        "formatter": 9,
                        "formatOptions": {
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 14",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"MFA\"\r\nor RecommendationDisplayName contains \"auth\"\r\nor RecommendationDisplayName contains \"pass\"\r\nor RecommendationDisplayName contains \"priv\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"management\"\r\nor RecommendationDisplayName contains \"owner\"\r\nor RecommendationDisplayName contains \"root\"\r\nor RecommendationDisplayName contains \"certificate\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Multi-Factor Authentication) Azure Security Center: Recommendations for Authentication",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Multi-Factor Authentication) Azure Security Center: Recommendations for Authentication"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| join kind=leftouter (ResourceContainers | where type=='microsoft.resources/subscriptions' | project SubName=name, subscriptionId) on subscriptionId\r\n| where type == 'microsoft.keyvault/vaults'\r\n| project id, type, location, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ (Application Developer Guidance) Leverage Azure Key Vault to Store Secrets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "name",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 14",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityBaseline\r\n| where Description contains \"password\"\r\n| distinct AnalyzeResult, Description, ResourceId, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Password Policies) Monitor Azure Password Policy Compliance with Security Baselines",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AnalyzeResult",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Passed",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Failed",
                                "representation": "critical",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "question",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 14",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 12",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 13",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Valid Accounts",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "InitialAccess"
      },
      "name": "Initial Access Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Execution](https://attack.mitre.org/tactics/TA0002/)\r\n---\r\nThe adversary is trying to run malicious code. Execution consists of techniques that result in adversary-controlled code running on a local or remote system. Techniques that run malicious code are often paired with techniques from all other tactics to achieve broader goals, like exploring a network or stealing data. For example, an adversary might use a remote access tool to run a PowerShell script that does Remote System Discovery.\r\n"
            },
            "customWidth": "45",
            "name": "Execution Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 4"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "5b13d997-d3fd-4f6b-b0e6-14b0cac2a940",
                  "cellValue": "Execution Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "preText": "",
                  "style": "link"
                },
                {
                  "id": "ce3edba8-8da1-4084-aedb-11c371f4554c",
                  "cellValue": "User Execution",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è User Execution",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Execution Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Execution\" and AlertName <> \"Azure Firewall IDPS\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExecution Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èExecution Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Execution\"\r\n| summarize count() by Product\r\n| sort by count_ desc\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èExecution Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èExecution Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Execution Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [User Execution (T1204)](https://attack.mitre.org/techniques/T1204)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Malicious Link (T1204.001)](https://attack.mitre.org/techniques/T1204/001/)<br> \r\nüü• Ô∏è[Malicious File (T1204.002)](https://attack.mitre.org/techniques/T1204/002/)<br> \r\nüü• Ô∏è[Malicious Image (T1204.003)](https://attack.mitre.org/techniques/T1204/003/)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall](https://azure.microsoft.com/services/azure-firewall/) <br> üî∑ [Syslog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/syslog) ‚ú≥Ô∏è [Collect Syslog Data Sources with Log Analytics Agent](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-syslog) <br> \r\n\r\n### Mitigations\r\nüü¶ [Execution Prevention (M1038)](https://attack.mitre.org/mitigations/M1038)<br>\r\nüü¶ [Network Intrusion Prevention (M1031)](https://attack.mitre.org/mitigations/M1031)<br>\r\nüü¶ [Restrict Web-Based Content (M1021)](https://attack.mitre.org/mitigations/M1021)<br> \r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Execution Prevention) Leverage Microsoft Defender Application Guard](https://docs.microsoft.com/windows/security/threat-protection/microsoft-defender-application-guard/md-app-guard-overview)<br> \r\nüí° [(Network Intrusion Prevention) Leverage Azure Firewall for Network Intrusion Prevention](https://docs.microsoft.com/azure/firewall/premium-features#idpst)<br>\r\nüí° [(Restrict Web-Based Content) Leverage Microsoft Defender for Endpoint for Web Content Filtering](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/web-content-filtering)<br>\r\nüí° [(User Training) Leverage Microsoft Learn for Security Threat Training](https://docs.microsoft.com/learn/browse/?terms=security%20threat)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> üîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br> üîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics contains \"Execution\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExecution Tactics ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èExecution Tactics ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let v_StartTime = ago(7d);\r\nlet v_EndTime = ago(1m);\r\nlet basic=materialize(\r\n    SecurityEvent\r\n    | where TimeGenerated >= ago(30d)\r\n    | where EventID == 4688\r\n    | where isnotempty(CommandLine) and NewProcessName !endswith \":\\\\windows\\\\system32\\\\conhost.exe\" and CommandLine !~ NewProcessName and CommandLine !~ strcat('\\\"', NewProcessName, '\\\"', \" \")\r\n    | extend CommandLine=tolower(CommandLine)\r\n    | summarize FullCount = count()\r\n        , Count= countif(TimeGenerated between (v_StartTime..v_EndTime))\r\n        , min_TimeGenerated=min(TimeGenerated)\r\n        , max_TimeGenerated=max(TimeGenerated) \r\n        by Computer, NewProcessName, CommandLine\r\n    | where Count > 0 and Count < 100);\r\nlet basic_avg = basic\r\n    | summarize Avg = avg(FullCount) by NewProcessName, CommandLine;\r\nbasic\r\n| project-away FullCount\r\n| join kind=inner \r\n    basic_avg \r\n    on NewProcessName, CommandLine\r\n| project-away NewProcessName1, CommandLine1\r\n| where Count < 7 or (Count <= Avg * 0.01 and Count < 100) \r\n| extend HostCustomEntity=Computer\r\n| sort by Count desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èHost Running Rare Process From Command Line",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Computer",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityEvent\r\n| where CommandLine <> \"\"\r\n| where CommandLine contains \".exe\" or CommandLine contains \".scr\" or CommandLine contains \".cpl\" or CommandLine contains \".scr\" or CommandLine contains \".pdf\" or CommandLine contains \".doc\" or CommandLine contains \".zip\"\r\n| where CommandLine contains \"ping\" or CommandLine contains \"nslookup\" or CommandLine contains \"tracert\" or CommandLine contains \"arp\" or CommandLine contains \"ipconfig\" or CommandLine contains \"route\" or CommandLine contains \"netstat\" or CommandLine contains \"netuser\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by CommandLine\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Execution Prevention) Microsoft Defender for Endpoint: File Executed from Command Line",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| where OperationName == \"AzureFirewallIDSLog\"\r\n| parse msg_s with * \"TCP request from \" Source \" to \" Destination \". Action: \" ActionTaken \". Rule: \" IDPSSig \". IDS: \" IDSMessage \". Priority: \" Priority \". Classification: \" Classification\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Network Intrusion Detection) Azure Firewall: IPDS Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where ProviderName in ({Product})\r\n| where AlertName contains \"URL\" or AlertName contains \"web\" or AlertName contains \"indicator\" or Description contains \"URL\" or AlertType contains \"NetworkProtectionBlocked\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict Web-Based Content) Web Content Filtering",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### üü¶ (User Training) Leverage Microsoft Learn for Security Threat Training\r\n![Image¬†Name](https://docs.microsoft.com/learn/modules/intro-to-security-in-azure/media/1-heading.png¬†¬†\"Microsoft Learn\")¬†\r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Learn](https://docs.microsoft.com/learn/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 10",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "User Execution",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Execution"
      },
      "name": "Execution Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Persistence](https://attack.mitre.org/tactics/TA0003/) \r\n---\r\nThe adversary is trying to maintain their foothold. Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access. Techniques used for persistence include any access, action, or configuration changes that let them maintain their foothold on systems, such as replacing or hijacking legitimate code or adding startup code.\r\n"
            },
            "customWidth": "45",
            "name": "Persistence Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 7"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "6b9196cd-8d75-4ab4-859a-fe9ea62b9046",
                  "cellValue": "Persistence Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "71564dd6-948f-46f8-99ff-483c095baaf4",
                  "cellValue": "Account Manipulation",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Account Manipulation",
                  "style": "link"
                },
                {
                  "id": "b8498f9f-dbc2-469a-a331-7386a86e4626",
                  "cellValue": "Create Account",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Create Account",
                  "style": "link"
                },
                {
                  "id": "e51cff71-662f-4571-a942-274af1210a7c",
                  "cellValue": "Implant Internal Image",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Implant Internal Image",
                  "style": "link"
                },
                {
                  "id": "1b076b8d-51c0-4d06-879c-78eea7c73847",
                  "cellValue": "Office Application Startup",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Office Application Startup",
                  "style": "link"
                },
                {
                  "id": "e9cb112f-5250-426c-8c39-26cdd57ef1f7",
                  "cellValue": "Valid Accounts",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Valid Accounts (Check: Initial Access)",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Persistence Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Persistence\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èPersistence Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èPersistence Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Persistence\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èPersistence Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èPersistence Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Persistence Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Account Manipulation (T1098)](https://attack.mitre.org/techniques/T1098)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Additional Cloud Credentials (T1098.001)](https://attack.mitre.org/techniques/T1098/001)<br> \r\nüü• Ô∏è[Exchange Email Delegate Permissions (T1098.002)](https://attack.mitre.org/techniques/T1098/002)<br> \r\nüü• Ô∏è[Add Office 365 Global Administrator Role (T1098.003)](https://attack.mitre.org/techniques/T1098/003)<br>\r\n\r\n### Recommended Logs\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [VMComputer](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmcomputer) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> üî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\nüü¶ [Network Segmentation (M1030)](https://attack.mitre.org/mitigations/M1030)<br>\r\nüü¶ [Operating System Configuration(M1028)](https://attack.mitre.org/mitigations/M1028)<br> \r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Network Segmentation) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\nüí° [(Operating System Configuration) Tutorial: Monitor Changes and Update a Windows Virtual Machine in Azure](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-config-management)<br>\r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let auditLookback = {TimeRange:grain};\r\nlet opName = dynamic([\"Add user\", \"Invite external user\"]);\r\n// Helper function to extract relevant fields from AuditLog events\r\nlet auditLogEvents = view (startTimeSpan: timespan, operation: dynamic) {\r\n    AuditLogs\r\n    | where TimeGenerated >= ago(auditLookback)\r\n    | where OperationName in~ (operation)\r\n    | extend ModProps = iff(TargetResources.[0].modifiedProperties != \"[]\", TargetResources.[0].modifiedProperties, todynamic(\"NoValues\"))\r\n    | extend IpAddress = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).ipAddress), tostring(parse_json(tostring(InitiatedBy.app)).ipAddress))\r\n    | extend InitiatedByFull = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName), tostring(parse_json(tostring(InitiatedBy.app)).displayName))\r\n    | extend InitiatedBy = replace(\"_\", \"@\", tostring(split(InitiatedByFull, \"#\")[0]))\r\n    | extend TargetUserPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n    | extend TargetUserName = replace(\"_\", \"@\", tostring(split(TargetUserPrincipalName, \"#\")[0]))\r\n    | extend TargetResourceName = case(\r\n        isempty(tostring(TargetResources.[0].displayName)), TargetUserPrincipalName,\r\n        isnotempty(tostring(TargetResources.[0].displayName)) and tostring(TargetResources.[0].displayName) startswith \"upn:\", tolower(tostring(TargetResources.[0].displayName)),\r\n        tolower(tostring(TargetResources.[0].displayName))\r\n        )\r\n    | extend TargetUserName = replace(\"_\", \"@\", tostring(split(TargetUserPrincipalName, \"#\")[0]))\r\n    | extend TargetUserName = iff(isempty(TargetUserName), tostring(split(split(TargetResourceName, \",\")[0], \" \")[1]), TargetUserName) \r\n    | mvexpand ModProps\r\n    | extend PropertyName = tostring(ModProps.displayName), newValue = replace('\\\"', '', tostring(ModProps.newValue));\r\n};\r\n// Assigning time for First TargetUserName that was added\r\nlet FirstAdd = auditLogEvents(auditLookback, opName)  \r\n    | project FirstAddTimeUtc = TimeGenerated, Type, FirstInitiatedBy = InitiatedBy, IpAddress, FirstTargetUserName = TargetUserName, FirstTargetResourceName = TargetResourceName, \r\n        FirstOperationName = OperationName, FirstPropertyName = PropertyName, FirstnewValue = newValue, FirstCorrelationId = CorrelationId, FirstId = Id;\r\n// Assigning time for second TargetUserName that was added, which will allow us to see if a first TargetUserName added in is the Initiated by on the second in the later join\r\nlet SecondAdd = auditLogEvents(auditLookback, opName)  \r\n    | project SecondAddTimeUtc = TimeGenerated, Type, SecondInitiatedBy = InitiatedBy, IpAddress, SecondTargetUserName = TargetUserName, SecondTargetResourceName = TargetResourceName, \r\n        SecondOperationName = OperationName, SecondPropertyName = PropertyName, SecondnewValue = newValue, SecondCorrelationId = CorrelationId, SecondId = Id;\r\n//  Joining the FirstAdd with SecondAdd where the FirstAdd TargetUserName value matches the SecondAdd InitiatedBy.  This shows the new user adding a user.\r\nlet NewUserAddsUser = FirstAdd\r\n    | join SecondAdd on $left.FirstTargetUserName == $right.SecondInitiatedBy\r\n    // we only want items where the FirstAddTimeUtc is before the SecondAddTimeUtc\r\n    | where FirstAddTimeUtc < SecondAddTimeUtc\r\n;\r\n// Build out some of the properties for context\r\nNewUserAddsUser\r\n| extend FirstnewValue = split(FirstnewValue, \";\"), SecondnewValue = split(SecondnewValue, \";\")\r\n| extend PropertyUpdate = pack(FirstPropertyName, FirstnewValue, SecondPropertyName, SecondnewValue, \"FirstCorrelationId\", FirstCorrelationId, \"FirstId\", FirstId, \"SecondCorrelationId\", SecondCorrelationId, \"SecondId\", SecondId)\r\n| summarize PropertyUpdateSet = make_bag(PropertyUpdate)\r\n    by FirstAddTimeUtc, FirstInitiatedBy, FirstTargetUserName, SecondAddTimeUtc, SecondInitiatedBy, SecondTargetUserName, \r\n    IpAddress, FirstTargetResourceName, SecondTargetResourceName, FirstOperationName, SecondOperationName\r\n| extend timestamp = FirstAddTimeUtc, AccountCustomEntity = FirstInitiatedBy, HostCustomEntity = FirstTargetResourceName, IPCustomEntity = IpAddress\r\n| make-series count() default=0 on FirstAddTimeUtc from {TimeRange:start} to {TimeRange:end} step 1d by FirstTargetResourceName\r\n| render areachart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Granted Access and Grants Others Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName == \"Create role assignment\"\r\n| where ActivityStatus == \"Succeeded\" \r\n| project Caller, CallerIpAddress\r\n| evaluate basket()\r\n| join kind=leftouter (AzureActivity\r\n    | where OperationName == \"Create role assignment\"\r\n    | where ActivityStatus == \"Succeeded\"\r\n    | summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated) by Caller, CallerIpAddress)\r\n    on Caller, CallerIpAddress\r\n| project-away Caller1, CallerIpAddress1\r\n| extend timestamp = StartTime, AccountCustomEntity = Caller, IPCustomEntity = CallerIpAddress\r\n| project Caller, CallerIpAddress, StartTime\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExcessive Granting Privileges to Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// For AD SID mappings - https://docs.microsoft.com/windows/security/identity-protection/access-control/active-directory-security-groups\r\nlet WellKnownLocalSID = \"S-1-5-32-5[0-9][0-9]$\";\r\nlet WellKnownGroupSID = \"S-1-5-21-[0-9]*-[0-9]*-[0-9]*-5[0-9][0-9]$|S-1-5-21-[0-9]*-[0-9]*-[0-9]*-1102$|S-1-5-21-[0-9]*-[0-9]*-[0-9]*-1103$\";\r\nSecurityEvent \r\n| where AccountType == \"User\"\r\n// 4728 - A member was added to a security-enabled global group\r\n// 4732 - A member was added to a security-enabled local group\r\n// 4756 - A member was added to a security-enabled universal group\r\n| where EventID in (\"4728\", \"4732\", \"4756\")   \r\n| where TargetSid matches regex WellKnownLocalSID or TargetSid matches regex WellKnownGroupSID\r\n// Exclude Remote Desktop Users group: S-1-5-32-555\r\n| where TargetSid !in (\"S-1-5-32-555\")\r\n| project StartTimeUtc = TimeGenerated, EventID, Activity, Computer, TargetUserName, TargetDomainName, TargetSid, UserPrincipalName, SubjectUserName, SubjectUserSid \r\n| extend timestamp = StartTimeUtc, HostCustomEntity = Computer, AccountCustomEntity = UserPrincipalName\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Account Added to Built in Domain Local or Global Group",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"MFA\"\r\nor RecommendationDisplayName contains \"auth\"\r\nor RecommendationDisplayName contains \"pass\"\r\nor RecommendationDisplayName contains \"priv\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"management\"\r\nor RecommendationDisplayName contains \"owner\"\r\nor RecommendationDisplayName contains \"root\"\r\nor RecommendationDisplayName contains \"bound\"\r\nor RecommendationDisplayName contains \"certificate\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"internet\"\r\nor RecommendationDisplayName contains \"public\"\r\nor RecommendationDisplayName contains \"VPC\"\r\nor RecommendationDisplayName contains \"IP address\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Multi-Factor Authentication / Network Segmentation) Azure Security Center Recommendations for MFA & Network Segmentation",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Multi-Factor Authentication / Network Segmentation) Azure Security Center Recommendations for MFA & Network Segmentation"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMComputer \r\n| summarize count() by OperatingSystemFullName\r\n| render barchart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Operating System Configuration) Monitor Operating System Configurations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Account Manipulation",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Create Account (1136)](https://attack.mitre.org/techniques/T1136)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Cloud Account (T1136.003)](https://attack.mitre.org/techniques/T1136/003)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\nüî∑ [VMComputer](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmcomputer) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Mitigations\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\nüü¶ [Network Segmentation (M1030)](https://attack.mitre.org/mitigations/M1030)<br>\r\nüü¶ [Operating System Configuration (M1028)](https://attack.mitre.org/mitigations/M1028)<br> \r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Network Segmentation) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\nüí° [(Operating System Configuration) Tutorial: Monitor Changes and Update a Windows Virtual Machine in Azure](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-config-management)<br>\r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br> üîÄ [Virtual Machines](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Compute%2FVirtualMachines) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "BehaviorAnalytics\r\n| where ActionType == \"Add user\"\r\n| where ActivityInsights has \"True\"\r\n| join(\r\nAuditLogs\r\n) on $left.SourceRecordId == $right._ItemId\r\n| mv-expand TargetResources\r\n| extend Target =  iff(tostring(TargetResources.userPrincipalName) has \"#EXT#\",replace(\"_\",\"@\",tostring(split(TargetResources.userPrincipalName, \"#\")[0])),TargetResources.userPrincipalName),tostring(TargetResources.userPrincipalName)\r\n| extend DisplayName = tostring(UsersInsights.AccountDisplayName),\r\nUserPrincipalName = iff(UserPrincipalName has \"#EXT#\",replace(\"_\",\"@\",tostring(split(UserPrincipalName, \"#\")[0])),UserPrincipalName),\r\nUserName = iff(UserName has \"#EXT#\",replace(\"_\",\"@\",tostring(split(UserPrincipalName, \"#\")[0])),UserName)\r\n| sort by TimeGenerated desc\t\r\n| project TimeGenerated, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target,ActivityInsights ,SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by TargetUser\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous AAD Account Creation",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let current = 1d;\r\nlet auditLookback = {TimeRange:grain};\r\nlet propertyIgnoreList = dynamic([\"TargetId.UserType\", \"StsRefreshTokensValidFrom\", \"LastDirSyncTime\", \"DeviceOSVersion\", \"CloudDeviceOSVersion\", \"DeviceObjectVersion\"]);\r\nlet appIgnoreList = dynamic([\"Microsoft Azure AD Group-Based Licensing\"]);\r\nlet AuditTrail = AuditLogs \r\n    | where TimeGenerated >= ago(auditLookback) and TimeGenerated < ago(current)\r\n    | where isnotempty(tostring(parse_json(tostring(InitiatedBy.app)).displayName))\r\n    | extend InitiatedByApp = tostring(parse_json(tostring(InitiatedBy.app)).displayName)\r\n    | extend ModProps = TargetResources.[0].modifiedProperties\r\n    | extend InitiatedByIpAddress = tostring(parse_json(tostring(InitiatedBy.app)).ipAddress)\r\n    | extend TargetUserPrincipalName = tolower(tostring(TargetResources.[0].userPrincipalName))\r\n    | extend TargetResourceName = tolower(tostring(TargetResources.[0].displayName))\r\n    | mv-expand ModProps\r\n    | where isnotempty(tostring(parse_json(tostring(ModProps.newValue))[0]))\r\n    | extend PropertyName = tostring(ModProps.displayName), newValue = tostring(parse_json(tostring(ModProps.newValue))[0])\r\n    | where PropertyName !in~ (propertyIgnoreList) and (PropertyName !~ \"Action Client Name\" and newValue !~ \"DirectorySync\") and (PropertyName !~ \"Included Updated Properties\" and newValue !~ \"LastDirSyncTime\")\r\n    | where InitiatedByApp !in~ (appIgnoreList) and OperationName !~ \"Change user license\"\r\n    | summarize by OperationName, InitiatedByApp, TargetUserPrincipalName, InitiatedByIpAddress, TargetResourceName, PropertyName;\r\nlet AccountMods = AuditLogs\r\n    | where TimeGenerated >= ago(current)\r\n    | where isnotempty(tostring(parse_json(tostring(InitiatedBy.app)).displayName))\r\n    | extend InitiatedByApp = tostring(parse_json(tostring(InitiatedBy.app)).displayName)\r\n    | extend ModProps = TargetResources.[0].modifiedProperties\r\n    | extend InitiatedByIpAddress = tostring(parse_json(tostring(InitiatedBy.app)).ipAddress)\r\n    | extend TargetUserPrincipalName = tolower(tostring(TargetResources.[0].userPrincipalName))\r\n    | extend TargetResourceName = tolower(tostring(TargetResources.[0].displayName))\r\n    | mv-expand ModProps\r\n    | where isnotempty(tostring(parse_json(tostring(ModProps.newValue))[0]))\r\n    | extend PropertyName = tostring(ModProps.displayName), newValue = tostring(parse_json(tostring(ModProps.newValue))[0])\r\n    | where PropertyName !in~ (propertyIgnoreList) and (PropertyName !~ \"Action Client Name\" and newValue !~ \"DirectorySync\") and (PropertyName !~ \"Included Updated Properties\" and newValue !~ \"LastDirSyncTime\")\r\n    | where InitiatedByApp !in~ (appIgnoreList) and OperationName !~ \"Change user license\"\r\n    | extend ModifiedProps = pack(\"PropertyName\", PropertyName, \"newValue\", newValue, \"Id\", Id, \"CorrelationId\", CorrelationId) \r\n    | summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), Activity = make_bag(ModifiedProps) by Type, InitiatedByApp, TargetUserPrincipalName, InitiatedByIpAddress, TargetResourceName, Category, OperationName, PropertyName;\r\nlet RareAudits = AccountMods\r\n    | join kind= leftanti (\r\n        AuditTrail \r\n        )\r\n        on OperationName, InitiatedByApp, InitiatedByIpAddress, TargetUserPrincipalName;//, PropertyName; //uncomment if you want to see Rare Property changes.\r\nRareAudits\r\n| summarize StartTime = min(StartTimeUtc), EndTime = max(EndTimeUtc), make_set(Activity), make_set(PropertyName) by InitiatedByApp, OperationName, TargetUserPrincipalName, InitiatedByIpAddress, TargetResourceName\r\n| order by TargetUserPrincipalName asc, StartTime asc\r\n| extend timestamp = StartTime, AccountCustomEntity = TargetUserPrincipalName, HostCustomEntity = iff(set_PropertyName has_any ('DeviceOSType', 'CloudDeviceOSType'), TargetResourceName, ''), IPCustomEntity = InitiatedByIpAddress\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èRare Audit Activity Initiated by App",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let auditLookback = {TimeRange:grain};\r\n// Setting threshold to 3 as a default, change as needed.  Any operation that has been initiated by a user or app more than 3 times in the past 30 days will be exluded\r\nlet threshold = 3;\r\n// Helper function to extract relevant fields from AuditLog events\r\nlet auditLogEvents = view (startTimeSpan: timespan) {\r\n    AuditLogs\r\n    | where TimeGenerated >= ago(auditLookback)\r\n    | extend ModProps = TargetResources.[0].modifiedProperties\r\n    | extend IpAddress = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).ipAddress), tostring(parse_json(tostring(InitiatedBy.app)).ipAddress))\r\n    | extend InitiatedBy = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName), tostring(parse_json(tostring(InitiatedBy.app)).displayName))\r\n    | extend TargetResourceName = tolower(tostring(TargetResources.[0].displayName))\r\n    | mvexpand ModProps\r\n    | extend PropertyName = tostring(ModProps.displayName), newValue = replace('\\\"', \"\", tostring(ModProps.newValue));\r\n};\r\n// Get just the InitiatedBy and CorrleationId so we can look at associated audit activity\r\n// 2 other operations that can be part of malicious activity in this situation are \r\n// \"Add OAuth2PermissionGrant\" and \"Add service principal\", replace the below if you are interested in those as starting points for OperationName\r\nlet HistoricalConsent = auditLogEvents(auditLookback)  \r\n    | where OperationName == \"Consent to application\"\r\n    | summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), OperationCount = count() \r\n        by Type, InitiatedBy, IpAddress, TargetResourceName, Category, OperationName, PropertyName, newValue, CorrelationId, Id\r\n// Remove comment below to only include operations initiated by a user or app that is above the threshold for the last 30 days\r\n//| where OperationCount > threshold\r\n;\r\nlet Correlate = HistoricalConsent \r\n    | summarize by InitiatedBy, CorrelationId;\r\n// 2 other operations that can be part of malicious activity in this situation are \r\n// \"Add OAuth2PermissionGrant\" and \"Add service principal\", replace the below if you changed the starting OperationName above\r\nlet allOtherEvents = auditLogEvents(auditLookback) \r\n    | where OperationName != \"Consent to application\";\r\n// Gather associated activity based on audit activity for \"Consent to application\" and InitiatedBy and CorrleationId\r\nlet CorrelatedEvents = Correlate \r\n    | join allOtherEvents on InitiatedBy, CorrelationId\r\n    | summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated) \r\n        by Type, InitiatedBy, IpAddress, TargetResourceName, Category, OperationName, PropertyName, newValue, CorrelationId, Id\r\n;\r\n// Union the results\r\nlet Results = union isfuzzy=true HistoricalConsent, CorrelatedEvents;\r\n// newValues that are simple semi-colon separated, make those dynamic for easy viewing and Aggregate into the PropertyUpdate set based on CorrelationId and Id(DirectoryId)\r\nResults\r\n| extend newValue = split(newValue, \";\")\r\n| extend PropertyUpdate = pack(PropertyName, newValue, \"Id\", Id)\r\n// Extract scope requested\r\n| extend perms = tostring(parse_json(tostring(PropertyUpdate.[\"ConsentAction.Permissions\"]))[0])\r\n| extend scope = extract('Scope:\\\\s*([^,\\\\]]*)', 1, perms)\r\n// Filter out some common openid, and low privilege request scopes - uncomment line below to filter out where no scope is requested\r\n//| where isnotempty(scope)\r\n| where scope !contains 'openid' and scope !in ('user_impersonation', 'User.Read')\r\n| summarize StartTime = min(StartTimeUtc), EndTime = max(EndTimeUtc), PropertyUpdateSet = make_bag(PropertyUpdate), make_set(scope)\r\n    by InitiatedBy, IpAddress, TargetResourceName, OperationName, CorrelationId\r\n| extend timestamp = StartTime, AccountCustomEntity = InitiatedBy, IPCustomEntity = IpAddress\r\n| summarize count() by TargetResourceName\r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExcessive Consent to Application Discovery",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"MFA\"\r\nor RecommendationDisplayName contains \"auth\"\r\nor RecommendationDisplayName contains \"pass\"\r\nor RecommendationDisplayName contains \"priv\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"management\"\r\nor RecommendationDisplayName contains \"owner\"\r\nor RecommendationDisplayName contains \"root\"\r\nor RecommendationDisplayName contains \"bound\"\r\nor RecommendationDisplayName contains \"certificate\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"internet\"\r\nor RecommendationDisplayName contains \"public\"\r\nor RecommendationDisplayName contains \"VPC\"\r\nor RecommendationDisplayName contains \"IP address\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Multi-Factor Authentication / Network Segmentation) Azure Security Center Recommendations for MFA & Network Segmentation",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Multi-Factor Authentication / Network Segmentation) Azure Security Center Recommendations for MFA & Network Segmentation"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMComputer \r\n| summarize count() by OperatingSystemFullName\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Operating System Configuration) Monitor Operating System Configurations",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperatingSystemFullName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Create Account",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Implant Internal Image (1525)](https://attack.mitre.org/techniques/T1525)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Code Signing (M1045)](https://attack.mitre.org/mitigations/M1045)<br>\r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Azure Security Logging and Auditing](https://docs.microsoft.com/azure/security/fundamentals/log-audit)<br>\r\nüí° [(Code Signing) Create and merge a CSR in Key Vault](https://docs.microsoft.com/azure/key-vault/certificates/create-certificate-signing-request)<br>\r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Azure Monitor](https://portal.azure.com/#blade/Microsoft_Azure_Monitoring/AzureMonitoringBrowseBlade/overview) <br> üîÄ [Key Vaults](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br> üîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName contains \"image\" \r\nor RecommendationName contains \"container\"\r\nor RecommendationName contains \"code\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by¬†RecommendationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èInsecurely Deployed Image, Container, or Code",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc \r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityAlert\r\n| where AlertName contains \"code\"\r\n| summarize count() by AlertName\r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Code Signing) Monitor Code Alerts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4"
                }
              ]
            },
            "name": "Implant Internal Image",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Office Application Startup (1137)](https://attack.mitre.org/techniques/T1137)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Office Template Macros (T1137.001)](https://attack.mitre.org/techniques/T1137/001)<br> \r\nüü• Ô∏è[Office Test (T1137.002)](https://attack.mitre.org/techniques/T1137/002)<br> \r\nüü• Ô∏è[Outlook Forms (T1137.003)](https://attack.mitre.org/techniques/T1137/003)<br> \r\nüü• Ô∏è[Outlook Home Page (T1137.004)](https://attack.mitre.org/techniques/T1137/004)<br> \r\nüü• Ô∏è[Outlook Rules (T1137.005)](https://attack.mitre.org/techniques/T1137/005)<br> \r\nüü• Ô∏è[Add-ins (T1137.006)](https://attack.mitre.org/techniques/T1137/006)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> üî∑ [SecurityNestedRecommendation](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securitynestedrecommendation) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n\r\n\r\n### Mitigations\r\nüü¶ [Disable or Remove Feature or Program (M1042)](https://attack.mitre.org/mitigations/M1042)<br>\r\nüü¶ [Software Configuration (M1054)](https://attack.mitre.org/mitigations/M1054)<br>\r\nüü¶ [Update Software (M1051)](https://attack.mitre.org/mitigations/M1051)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Disable or Remove Feature or Program) Deploy Azure Security Center for Integrated Vulnerability Assessments](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br>\r\nüí° [(Software Configuration) Leverage Azure Automation Accounts for Updates/Patching](https://docs.microsoft.com/azure/automation/update-management/enable-from-portals)<br> \r\nüí° [(Update Software) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> üîÄ [Automation Accounts](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Automation%2FAutomationAccounts) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "OfficeActivity\r\n| where (Operation =~ \"Set-Mailbox\" and Parameters contains 'ForwardingSmtpAddress') \r\n    or (Operation =~ 'New-InboxRule' and Parameters contains 'ForwardTo')\r\n| extend parsed=parse_json(Parameters)\r\n| extend fwdingDestination_initial = (iif(Operation =~ \"Set-Mailbox\", tostring(parsed[1].Value), tostring(parsed[2].Value)))\r\n| where isnotempty(fwdingDestination_initial)\r\n| extend fwdingDestination = iff(fwdingDestination_initial has \"smtp\", (split(fwdingDestination_initial, \":\")[1]), fwdingDestination_initial)\r\n| parse fwdingDestination with * '@' ForwardedtoDomain \r\n| parse UserId with *'@' UserDomain\r\n| extend subDomain = ((split(strcat(tostring(split(UserDomain, '.')[-2]), '.', tostring(split(UserDomain, '.')[-1])), '.')[0]))\r\n| where ForwardedtoDomain !contains subDomain\r\n| extend Result = iff(ForwardedtoDomain != UserDomain, \"Mailbox rule created to forward to External Domain\", \"Forward rule for Internal domain\")\r\n| extend ClientIPAddress = case(ClientIP has \".\", tostring(split(ClientIP, \":\")[0]), ClientIP has \"[\", tostring(trim_start(@'[[]', tostring(split(ClientIP, \"]\")[0]))), ClientIP)\r\n| extend Port = case(\r\n    ClientIP has \".\", (split(ClientIP, \":\")[1]),\r\n    ClientIP has \"[\", tostring(split(ClientIP, \"]:\")[1]),\r\n    ClientIP\r\n    )\r\n| project TimeGenerated, UserId, UserDomain, subDomain, Operation, ForwardedtoDomain, ClientIPAddress, Result, Port, OriginatingServer, OfficeObjectId, fwdingDestination\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = UserId, IPCustomEntity = ClientIPAddress, HostCustomEntity = OriginatingServer\r\n| summarize count() by UserId, Operation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èOffice Mail Forwarding",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Operation",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "redBright",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "coldHot"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5 - Copy",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let processEvents=\r\n    SecurityEvent\r\n    | where EventID == 4688\r\n    // excluding well known processes\r\n    | where NewProcessName !endswith ':\\\\Windows\\\\System32\\\\conhost.exe' and ParentProcessName !endswith ':\\\\Windows\\\\System32\\\\conhost.exe'\r\n    | where ParentProcessName !endswith \":\\\\Windows\\\\System32\\\\wuauclt.exe\" and NewProcessName !startswith \"C:\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\Install\\\\AM_Delta_Patch_\"\r\n    | where NewProcessName !has \":\\\\Windows\\\\WinSxS\\\\amd64_microsoft-windows-servicingstack_\" and ParentProcessName !has \":\\\\Windows\\\\WinSxS\\\\amd64_microsoft-windows-servicingstack_\"\r\n    | where NewProcessName !endswith \":\\\\WindowsAzure\\\\SecAgent\\\\WaSecAgentProv.exe\" \r\n    | where ParentProcessName !has \":\\\\WindowsAzure\\\\GuestAgent_\" and NewProcessName !has \":\\\\WindowsAzure\\\\GuestAgent_\"\r\n    | where ParentProcessName !has \":\\\\WindowsAzure\\\\WindowsAzureNetAgent_\" and NewProcessName !has \":\\\\WindowsAzure\\\\WindowsAzureNetAgent_\"\r\n    | where ParentProcessName !has \":\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\platform\\\\\" and ParentProcessName !endswith \"\\\\MpCmdRun.exe\" \r\n    | where NewProcessName !has \":\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\platform\\\\\" and NewProcessName !endswith \"\\\\MpCmdRun.exe\" \r\n    | where NewProcessName !has ':\\\\Program Files\\\\Microsoft Monitoring Agent\\\\Agent\\\\'\r\n    // filter out common randomly named paths and files\r\n    | where not(NewProcessName matches regex @\"\\\\TRA[0-9A-Fa-f]{3}\\.tmp\")\r\n    | where not(NewProcessName matches regex @\"\\\\TRA[0-9A-Fa-f]{4}\\.tmp\")\r\n    | where not(NewProcessName matches regex @\"Installer\\\\MSI[0-9A-Fa-f]{3}\\.tmp\")\r\n    | where not(NewProcessName matches regex @\"Installer\\\\MSI[0-9A-Fa-f]{4}\\.tmp\")\r\n    | where not(NewProcessName matches regex @\"\\\\Windows\\\\Temp\\\\[0-9A-Za-z-]*\\\\DismHost\\.exe\")\r\n    | where not(NewProcessName matches regex @\"\\\\Users\\\\[0-9A-Za-z-_~\\.]*\\\\AppData\\\\Local\\\\Temp\\\\[0-9A-Za-z-]*\\\\DismHost\\.exe\")\r\n    | where not(NewProcessName matches regex @\"\\\\Windows\\\\Temp\\\\[0-9A-Za-z-]*\\\\MpSigStub\\.exe\")\r\n    | where not(NewProcessName matches regex @\"\\\\[0-9A-Za-z]*\\\\amd64\\\\setup\\.exe\") and (ParentProcessName !has \":\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\Install\\\\\" \r\n        or ParentProcessName !has \"\\\\AppData\\\\Local\\\\Temp\\\\mpam-\")\r\n    | where not(NewProcessName matches regex @\"\\\\Windows\\\\Microsoft.NET\\\\(Framework|Framework64)\\\\v[0-9].[0-9].[0-9]*\\\\(csc\\.exe|cvtres\\.exe|mscorsvw\\.exe|ngentask\\.exe|ngen\\.exe)\")\r\n    | where not(NewProcessName matches regex @\"\\\\WindowsAzure\\\\GuestAgent_[0-9].[0-9].[0-9]*.[0-9]*_[0-9]*-[0-9]*-[0-9]*_[0-9]*\\\\\") \r\n        and not(ParentProcessName matches regex @\"\\\\WindowsAzure\\\\GuestAgent_[0-9].[0-9].[0-9]*.[0-9]*_[0-9]*-[0-9]*-[0-9]*_[0-9]*\\\\\")\r\n    | where not(NewProcessName matches regex @\"\\\\[0-9A-Za-z]*\\\\epplauncher.exe\")\r\n    | where not(NewProcessName matches regex @\"\\\\Packages\\\\Plugins\\\\Microsoft\\.\")\r\n    | extend path_parts = parse_path(NewProcessName)\r\n    | extend ProcessPath = tostring(path_parts.DirectoryPath)\r\n;\r\nlet normalizedProcessPath = processEvents\r\n    | extend NormalizedProcessPath = ProcessPath\r\n    // normalize guids\r\n    | project TimeGenerated, Computer, Account, Process, ProcessPath, \r\n        NormalizedProcessPath = replace(\"[0-9A-Fa-f]{8}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{12}\", \"<guid>\", NormalizedProcessPath)\r\n    // normalize digits away\r\n    | project TimeGenerated, Computer, Account, Process, ProcessPath, NormalizedProcessPath = replace(@'\\d', '#', NormalizedProcessPath)\r\n; \r\nlet freqs = normalizedProcessPath\r\n    | summarize makelist(Computer), makelist(Account), makelist(ProcessPath), frequency=count() by NormalizedProcessPath, Process\r\n    | join kind= leftouter (\r\n        normalizedProcessPath\r\n        | summarize StartTimeUtc=min(TimeGenerated), EndTimeUtc=max(TimeGenerated) by NormalizedProcessPath, Process\r\n        )\r\n        on NormalizedProcessPath, Process;\r\nfreqs\r\n| where frequency <= toscalar(freqs\r\n    | serialize\r\n    | project frequency\r\n    | summarize percentiles(frequency, 5))\r\n| order by frequency asc  \r\n| mvexpand Computer = list_Computer, Account = list_Account, ProcessPath = list_ProcessPath\r\n| project StartTimeUtc, EndTimeUtc, frequency, Process, NormalizedProcessPath, tostring(ProcessPath), tostring(Computer), tostring(Account)\r\n\r\n| make-series count() default=0 on StartTimeUtc from {TimeRange:start} to {TimeRange:end} step 1d by Process\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èRare Process Path",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation \r\n| summarize count() by Description, VulnerabilityId, RecommendationSeverity\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Disable or Remove Feature or Program) Vulnerable Software",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "3",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Software Configuration) Leverage Azure Automation Accounts for Updates/Patching\r\n![ImageName](https://docs.microsoft.com/azure/automation/update-management/media/overview/update-mgmt-updateworkflow.png)\r\n\r\n‚ú≥Ô∏è [Get Started with Azure Automation]( https://azure.microsoft.com/services/automation/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Leverage Sentinel Hunting: Initial Access Filter",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"agent should be installed\"\r\nor RecommendationDisplayName contains \"agent health\"\r\nor RecommendationDisplayName contains \"system updates\"\r\nor RecommendationDisplayName contains \"upgrade\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "title": "üü¶ Ô∏è(Update Software) Azure Security Center Recommendations for Updates",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Update Software) Azure Security Center Recommendations for Updates"
                }
              ]
            },
            "name": "Office Application Startup",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Persistence"
      },
      "name": "Persistence Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Privilege Escalation](https://attack.mitre.org/tactics/TA0004/)\r\n---\r\nThe adversary is trying to gain higher-level permissions. Privilege Escalation consists of techniques that adversaries use to gain higher-level permissions on a system or network. Adversaries can often enter and explore a network with unprivileged access but require elevated permissions to follow through on their objectives. Common approaches are to take advantage of system weaknesses, misconfigurations, and vulnerabilities. "
            },
            "customWidth": "45",
            "name": "text - 3"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 4"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "c7eab859-c4cb-4239-ac09-38dcf595c707",
                  "cellValue": "Privilege Escalation\tTactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "55f3369a-48cd-4ed4-a22b-24b72072f114",
                  "cellValue": "Domain Policy Modification",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Domain Policy Modification",
                  "style": "link"
                },
                {
                  "id": "66c1dd9f-196b-45be-a06d-90f3d4aff283",
                  "cellValue": "Valid Accounts",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Valid Accounts (Check: Initial Access)",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Privilege Escalation Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"privilege\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èPrivilege Escalation Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èPrivilege Escalation Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"privilege\"\r\n| summarize count() by Product\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èPrivilege Escalation Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èPrivilege Escalation Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Privilege Escalation\tTactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Domain Policy Modification (T1484)](https://attack.mitre.org/techniques/T1484)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Domain Trust Modification (T1484.002)](https://attack.mitre.org/techniques/T1484/002/)<br>\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [DeviceEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/deviceevents) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br> \r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Review Policy/Trust Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\nüí° [(User Account Management) Monitor User Endpoint Activity Alerts](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/manage-alerts)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> \r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Result == \"success\"\r\n| where OperationName == \"Add member to group\"\r\n| where tostring(InitiatedBy.user.userPrincipalName) has \"@\" or tostring(InitiatedBy.app.displayName) has \"@\"\r\n| extend Type = tostring(TargetResources[0].type)\r\n| where Type =~ \"ServicePrincipal\"\r\n| extend UserAgent = tostring(AdditionalDetails[0].value)\r\n| extend UserIPAddress = tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)\r\n| extend InitiatingUser = tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)\r\n| extend TargetUserId = tostring(TargetResources[0].id)\r\n| extend TargetUserName = tostring(TargetResources[0].displayName)\r\n| extend props = parse_json(tostring(TargetResources[0].modifiedProperties))\r\n| mv-expand props\r\n| extend PropName = tostring(props.displayName)\r\n| where PropName == \"Group.DisplayName\"\r\n| extend GroupName = tostring(parse_json(tostring(props.newValue)))\r\n| project InitiatingUser, OperationName, TargetUserName, TimeGenerated",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏è Service Principals Given Additional Privileges",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "InitiatingUser",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let auditLookback = {TimeRange:grain};\r\nlet opName = dynamic([\"Add user\", \"Invite external user\"]);\r\n// Helper function to extract relevant fields from AuditLog events\r\nlet auditLogEvents = view (startTimeSpan: timespan, operation: dynamic) {\r\n    AuditLogs\r\n    | where TimeGenerated >= ago(auditLookback)\r\n    | where OperationName in~ (operation)\r\n    | extend ModProps = iff(TargetResources.[0].modifiedProperties != \"[]\", TargetResources.[0].modifiedProperties, todynamic(\"NoValues\"))\r\n    | extend IpAddress = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).ipAddress), tostring(parse_json(tostring(InitiatedBy.app)).ipAddress))\r\n    | extend InitiatedByFull = iff(isnotempty(tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)), \r\n        tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName), tostring(parse_json(tostring(InitiatedBy.app)).displayName))\r\n    | extend InitiatedBy = replace(\"_\", \"@\", tostring(split(InitiatedByFull, \"#\")[0]))\r\n    | extend TargetUserPrincipalName = tostring(TargetResources[0].userPrincipalName)\r\n    | extend TargetUserName = replace(\"_\", \"@\", tostring(split(TargetUserPrincipalName, \"#\")[0]))\r\n    | extend TargetResourceName = case(\r\n        isempty(tostring(TargetResources.[0].displayName)), TargetUserPrincipalName,\r\n        isnotempty(tostring(TargetResources.[0].displayName)) and tostring(TargetResources.[0].displayName) startswith \"upn:\", tolower(tostring(TargetResources.[0].displayName)),\r\n        tolower(tostring(TargetResources.[0].displayName))\r\n        )\r\n    | extend TargetUserName = replace(\"_\", \"@\", tostring(split(TargetUserPrincipalName, \"#\")[0]))\r\n    | extend TargetUserName = iff(isempty(TargetUserName), tostring(split(split(TargetResourceName, \",\")[0], \" \")[1]), TargetUserName) \r\n    | mvexpand ModProps\r\n    | extend PropertyName = tostring(ModProps.displayName), newValue = replace('\\\"', '', tostring(ModProps.newValue));\r\n};\r\n// Assigning time for First TargetUserName that was added\r\nlet FirstAdd = auditLogEvents(auditLookback, opName)  \r\n    | project FirstAddTimeUtc = TimeGenerated, Type, FirstInitiatedBy = InitiatedBy, IpAddress, FirstTargetUserName = TargetUserName, FirstTargetResourceName = TargetResourceName, \r\n        FirstOperationName = OperationName, FirstPropertyName = PropertyName, FirstnewValue = newValue, FirstCorrelationId = CorrelationId, FirstId = Id;\r\n// Assigning time for second TargetUserName that was added, which will allow us to see if a first TargetUserName added in is the Initiated by on the second in the later join\r\nlet SecondAdd = auditLogEvents(auditLookback, opName)  \r\n    | project SecondAddTimeUtc = TimeGenerated, Type, SecondInitiatedBy = InitiatedBy, IpAddress, SecondTargetUserName = TargetUserName, SecondTargetResourceName = TargetResourceName, \r\n        SecondOperationName = OperationName, SecondPropertyName = PropertyName, SecondnewValue = newValue, SecondCorrelationId = CorrelationId, SecondId = Id;\r\n//  Joining the FirstAdd with SecondAdd where the FirstAdd TargetUserName value matches the SecondAdd InitiatedBy.  This shows the new user adding a user.\r\nlet NewUserAddsUser = FirstAdd\r\n    | join SecondAdd on $left.FirstTargetUserName == $right.SecondInitiatedBy\r\n    // we only want items where the FirstAddTimeUtc is before the SecondAddTimeUtc\r\n    | where FirstAddTimeUtc < SecondAddTimeUtc\r\n;\r\n// Build out some of the properties for context\r\nNewUserAddsUser\r\n| extend FirstnewValue = split(FirstnewValue, \";\"), SecondnewValue = split(SecondnewValue, \";\")\r\n| extend PropertyUpdate = pack(FirstPropertyName, FirstnewValue, SecondPropertyName, SecondnewValue, \"FirstCorrelationId\", FirstCorrelationId, \"FirstId\", FirstId, \"SecondCorrelationId\", SecondCorrelationId, \"SecondId\", SecondId)\r\n| summarize PropertyUpdateSet = make_bag(PropertyUpdate)\r\n    by FirstAddTimeUtc, FirstInitiatedBy, FirstTargetUserName, SecondAddTimeUtc, SecondInitiatedBy, SecondTargetUserName, \r\n    IpAddress, FirstTargetResourceName, SecondTargetResourceName, FirstOperationName, SecondOperationName\r\n| extend timestamp = FirstAddTimeUtc, AccountCustomEntity = FirstInitiatedBy, HostCustomEntity = FirstTargetResourceName, IPCustomEntity = IpAddress",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Granted Access and Grants Others Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "FirstInitiatedBy",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èUser Granted Access and Grants Others Access",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"policy\"\r\nor RecommendationDisplayName contains \"trust\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Azure Security Center: Trust/Policy Recommendations",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Audit) Azure Security Center: Trust/Policy Recommendations"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"wmi\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Monitor WMI Usage",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(User Account Management) Monitor WMI Usage",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Domain Policy Modification",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "PrivilegeEscalation"
      },
      "name": "Privilege Escalation"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Defense Evasion](https://attack.mitre.org/tactics/TA0005/) \r\n---\r\nThe adversary is trying to avoid being detected. Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. Other tactics‚Äô techniques are cross-listed here when those techniques include the added benefit of subverting defenses.\r\n"
            },
            "customWidth": "45",
            "name": "Defense Evasion Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 7"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "3f2ec9e6-a4e2-4304-b814-d3f0e3f79f1c",
                  "cellValue": "Defense Evasion Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "cbd3026f-b627-4c56-8c79-bd5cb960cf35",
                  "cellValue": "Domain Policy Modification",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Domain Policy Modification (Check: Privilege Escalation)",
                  "style": "link"
                },
                {
                  "id": "24351408-2722-4717-9818-c2c1a17c923d",
                  "cellValue": "Impair Defenses",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Impair Defenses",
                  "style": "link"
                },
                {
                  "id": "f6e5fc58-140f-448a-b759-390afebadbf4",
                  "cellValue": "Modify Cloud Compute Infrastructure",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Modify Cloud Compute Infrastructure",
                  "style": "link"
                },
                {
                  "id": "bc65f762-91bb-4859-9d14-bb2dfeb3af46",
                  "cellValue": "Unused/Unsupported Cloud Regions",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Unused/Unsupported Cloud Regions",
                  "style": "link"
                },
                {
                  "id": "557b9832-4920-46c2-8ae7-cd406d35aef9",
                  "cellValue": "Use Alternate Authentication Material",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Use Alternate Authentication Material",
                  "style": "link"
                },
                {
                  "id": "6a5249dc-2d74-4b23-b32c-6a5bca62f41e",
                  "cellValue": "Valid Accounts",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Valid Accounts (Check: Initial Access)",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Defense Evasion Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Defense\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èDefense Evasion Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èDefense Evasion Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Defense\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èDefense Evasion Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èDefense Evasion Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Defense Evasion Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Impair Defenses (1562)](https://attack.mitre.org/techniques/T1562)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Disable or Modify Tools (T1562.001)](https://attack.mitre.org/techniques/T1562/001)<br> \r\nüü• Ô∏è[Disable or Modify Cloud Firewall (T1562.007)](https://attack.mitre.org/techniques/T1562/007)<br> \r\nüü• Ô∏è[Disable Cloud Logs (T1562.008)](https://attack.mitre.org/techniques/T1562/008)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [ProtectionStatus](https://docs.microsoft.com/azure/azure-monitor/reference/tables/protectionstatus) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [InformationProtectionLogs_CL](https://docs.microsoft.com/azure/information-protection/audit-logs) ‚ú≥Ô∏è [Azure Information Protection](https://azure.microsoft.com/services/information-protection/) <br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/) <br> üî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> üî∑ [DeviceRegistryEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/deviceregistryevents) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n\r\n\r\n### Mitigations\r\nüü¶ [Restrict File and Directory Permissions (M1022)](https://attack.mitre.org/mitigations/M1022)<br>\r\nüü¶ [Restrict Registry Permissions (M1024)](https://attack.mitre.org/mitigations/M1024)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Restrict File and Directory Permissions) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Restrict Registry Permissions) File integrity monitoring in Azure Security Center](https://docs.microsoft.com/azure/security-center/security-center-file-integrity-monitoring)<br> \r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> üîÄ [Azure Information Protection](https://portal.azure.com/#blade/Microsoft_Azure_InformationProtection/DataClassGroupEditBlade/quickstartBlade) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"delete\" or OperationName contains \"remove\" or OperationName contains \"disable\"\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èDeleting Resources/Assets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ProtectionStatus \r\n| where ProtectionStatus <> \"Real time protection\"\r\n| summarize count() by ResourceId,TypeofProtection, ProtectionStatus\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èEndpoint Protection Status Issue",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let operations = dynamic(['Remove database vulnerability assessment rule baseline']);\r\nBehaviorAnalytics\r\n| where ActionType in(operations)\r\n| where ActivityInsights has \"True\"\r\n| project TimeGenerated, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by UserPrincipalName\r\n| render areachart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous Defensive Mechanism Modification",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let timeframe = {TimeRange:grain};\r\nSecurityEvent\r\n| where TimeGenerated >= ago(timeframe)\r\n| where EventID == 1102 and EventSourceName == \"Microsoft-Windows-Eventlog\" \r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), EventCount = count() by Computer, Account, EventID, Activity\r\n| extend timestamp = StartTimeUtc, AccountCustomEntity = Account, HostCustomEntity = Computer",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èClearing Windows Event Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "InformationProtectionLogs_CL\r\n| where Activity_s contains \"downgrade\" or Activity_s contains \"delete\" or Activity_s contains \"remove\"\r\n| project Activity_s, UserId_s, ObjectId_s, ApplicationName_s_s, ProtectionOwner_s, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èDowngrading Data Loss Prevention Labels",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Activity_s",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 9",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let opList = OfficeActivity \r\n| summarize by Operation\r\n//| where Operation startswith \"Remove-\" or Operation startswith \"Disable-\"\r\n| where Operation has_any (\"Remove\", \"Disable\")\r\n| where Operation contains \"AntiPhish\" or Operation contains \"SafeAttachment\" or Operation contains \"SafeLinks\" or Operation contains \"Dlp\" or Operation contains \"Audit\"\r\n| summarize make_set(Operation);\r\nOfficeActivity\r\n// Only admin or global-admin can disable/remove policy\r\n| where RecordType =~ \"ExchangeAdmin\"\r\n| where UserType in~ (\"Admin\",\"DcAdmin\")\r\n// Pass in interesting Operation list\r\n| where Operation in~ (opList)\r\n| extend ClientIPOnly = case( \r\nClientIP has \".\", tostring(split(ClientIP,\":\")[0]), \r\nClientIP has \"[\", tostring(trim_start(@'[[]',tostring(split(ClientIP,\"]\")[0]))),\r\nClientIP\r\n)  \r\n| extend Port = case(\r\nClientIP has \".\", (split(ClientIP,\":\")[1]),\r\nClientIP has \"[\", tostring(split(ClientIP,\"]:\")[1]),\r\nClientIP\r\n)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), OperationCount = count() by Operation, UserType, UserId, ClientIP = ClientIPOnly, Port, ResultStatus, Parameters\r\n| extend timestamp = StartTimeUtc, AccountCustomEntity = UserId, IPCustomEntity = ClientIP",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èOffice Policy Tampering",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"file\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"directory\"\r\nor RecommendationDisplayName contains \"permiss\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict File and Directory Permissions) Azure Security Center Recommendations for File/Directory Permissions",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Restrict File and Directory Permissions) Azure Security Center Recommendations for File/Directory Permissions"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DeviceRegistryEvents \r\n| where ActionType == \"RegistryValueSet\" \r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by InitiatingProcessAccountName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict Registry Permissions) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 9",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n| take 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 10",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Impair Defenses",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Modify Cloud Compute Infrastructure (1578)](https://attack.mitre.org/techniques/T1578/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Create Snapshot (T1578.001)](https://attack.mitre.org/techniques/T1578/001)<br> \r\nüü• Ô∏è[Create Cloud Instance (T1578.001)](https://attack.mitre.org/techniques/T1578/001)<br> \r\nüü• Ô∏è[Delete Cloud Instance(T1578.001)](https://attack.mitre.org/techniques/T1578/001)<br> \r\nüü• Ô∏è[Revert Cloud Instance (T1578.001)](https://attack.mitre.org/techniques/T1578/001)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> \r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Azure Security Logging and Auditing](https://docs.microsoft.com/azure/security/fundamentals/log-audit)<br>\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"create\" or OperationName contains \"delete\" or OperationName contains \"remove\" or OperationName contains \"modif\" \r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Caller\r\n| render timechart",
                    "size": 0,
                    "showAnnotations": true,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èModification of Cloud Compute Infrastructure",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by Caller\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Modify Cloud Compute Infrastructure",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Unused/Unsupported Cloud Regions (1535)](https://attack.mitre.org/techniques/T1535/)\r\n\r\n### Recommended Logs\r\nüî∑ [Resources](https://docs.microsoft.com/azure/governance/resource-graph/samples/starter?tabs=azure-cli) ‚ú≥Ô∏è [Get Started with Azure Resource Graph](https://azure.microsoft.com/features/resource-graph/) \r\n\r\n### Mitigations\r\nüü¶ [Software Configuration (M1054)](https://attack.mitre.org/mitigations/M1054)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Software Configuration) How to Create Azure Monitor Alerts for Non-Compliant Azure Policies](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-create-azure-monitor-alerts-for-non-compliant-azure/ba-p/713466)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview)"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where  type contains \"microsoft\"\r\n| project id,type,location,resourceGroup\r\n// | where location <> \"Authorized Cloud Regions\"\r\n| summarize count() by location\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Unused/Unsupported Cloud Regions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "location",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "Computer",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Software Configuration) Leverage Azure Policy for Region Configuration Control\r\n![ImageName](https://techcommunity.microsoft.com/t5/image/serverpage/image-id/120046i5D3428FD31CE1F0F/image-size/large?v=v2&px=999)\r\n\r\n‚ú≥Ô∏è [Get Started with Azure Policy](https://azure.microsoft.com/services/azure-policy/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Unused/Unsupported Cloud Regions",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Use Alternate Authentication Material (1550)](https://attack.mitre.org/techniques/T1550/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Application Access Token (T1550.001)](https://attack.mitre.org/techniques/T1550/001)<br> \r\nüü• Ô∏è[Web Session Cookie (T1550.004)](https://attack.mitre.org/techniques/T1550/004)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\nüí° [(User Account Management) Review Access Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br>  \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Privileged Identity Management](https://portal.azure.com/#blade/Microsoft_Azure_PIMCommon/CommonMenuBlade/quickStart)  <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n| where parse_json(AuthenticationDetails)[0].authenticationStepRequirement <> \"Primary authentication\"\r\n| summarize count() by UserPrincipalName, AppDisplayName, ResultDescription\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUsing Alternate Authentication Material",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"account\"\r\nor RecommendationDisplayName contains \"cred\"\r\nor RecommendationDisplayName contains \"IAM\"\r\nor RecommendationDisplayName contains \"identity\"\r\nor RecommendationDisplayName contains \"privilege\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Azure Security Center: Access Recommendations",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(User Account Management) Azure Security Center: Access Recommendations"
                }
              ]
            },
            "name": "Use Alternate Authentication Material",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "DefenseEvasion"
      },
      "name": "Defense Evasion Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# [Credential Access](https://attack.mitre.org/tactics/TA0006/)\r\n---\r\nThe adversary is trying to steal account names and passwords. Credential Access consists of techniques for stealing credentials like account names and passwords. Techniques used to get credentials include keylogging or credential dumping. Using legitimate credentials can give adversaries access to systems, make them harder to detect, and provide the opportunity to create more accounts to help achieve their goals."
            },
            "customWidth": "45",
            "name": "text - 3"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 8"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "9d2dcbdf-9a07-41c8-b3b4-97cc0f82a618",
                  "cellValue": "Credential Access Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "preText": "",
                  "style": "link"
                },
                {
                  "id": "42efd5a5-d7aa-4105-aff0-d4feb8ac697f",
                  "cellValue": "Brute Force",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Brute Force",
                  "style": "link"
                },
                {
                  "id": "eee96c38-5570-4e5f-a9d2-2c0db6c56ad7",
                  "cellValue": "Forge Web Credentials",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Forge Web Credentials",
                  "style": "link"
                },
                {
                  "id": "7cfaa512-fa3e-4374-b9a3-d3920c0e84b4",
                  "cellValue": "Steal Application Access Token",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Steal Application Access Token",
                  "style": "link"
                },
                {
                  "id": "62d13659-daf2-4d99-8167-7f761a115728",
                  "cellValue": "Steal Web Session Cookie",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Steal Web Session Cookie",
                  "style": "link"
                },
                {
                  "id": "aac2121b-6676-440d-81af-145687a781ba",
                  "cellValue": "Unsecured Credentials",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Unsecured Credentials",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Credential Access Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"credential\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCredential Access Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èCredential Access Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"credential\"\r\n| summarize count() by Product\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èCredential Access Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èCredential Access Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Credential Access Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Brute Force (1110)](https://attack.mitre.org/techniques/T1110/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Password Guessing (T1110.001)](https://attack.mitre.org/techniques/T1110/001)<br> \r\nüü• Ô∏è[Password Cracking (T1110.002)](https://attack.mitre.org/techniques/T1110/002)<br> \r\nüü• Ô∏è[Password Spraying (T1110.003)](https://attack.mitre.org/techniques/T1110/003)<br> \r\nüü• Ô∏è[Credential Stuffing (T1110.004)](https://attack.mitre.org/techniques/T1110/004)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [AADNonInteractiveUserSignInLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/aadnoninteractiveusersigninlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Account Use Policies (M1036)](https://attack.mitre.org/mitigations/M1036)<br>\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\nüü¶ [Password Policies (M1027)](https://attack.mitre.org/mitigations/M1027)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Account Use Policies) How to Create Azure Monitor Alerts for Non-Compliant Azure Policies](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-create-azure-monitor-alerts-for-non-compliant-azure/ba-p/713466)<br>\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Password Policies) Password and Account Lockout Policies on Azure Active Directory Domain Services Managed Domains](https://docs.microsoft.com/azure/active-directory-domain-services/password-policy#)<br> \r\nüí° [(User Account Management) Review Access Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let failureCountThreshold = 5;\r\nlet successCountThreshold = 1;\r\nlet authenticationWindow = 20m;\r\nlet aadFunc = (tableName:string){\r\ntable(tableName)\r\n| extend DeviceDetail = todynamic(DeviceDetail), Status = todynamic(DeviceDetail), LocationDetails = todynamic(LocationDetails)\r\n| extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser\r\n| extend StatusCode = tostring(Status.errorCode), StatusDetails = tostring(Status.additionalDetails)\r\n| extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city), Region = tostring(LocationDetails.countryOrRegion)\r\n// Split out failure versus non-failure types\r\n| extend FailureOrSuccess = iff(ResultType in (\"0\", \"50125\", \"50140\", \"70043\", \"70044\"), \"Success\", \"Failure\")\r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), IPAddress = make_set(IPAddress), make_set(OS), make_set(Browser), make_set(City),\r\nmake_set(State), make_set(Region),make_set(ResultType), FailureCount = countif(FailureOrSuccess==\"Failure\"), SuccessCount = countif(FailureOrSuccess==\"Success\") \r\nby bin(TimeGenerated, authenticationWindow), UserDisplayName, UserPrincipalName, AppDisplayName, Type\r\n| where FailureCount >= failureCountThreshold and SuccessCount >= successCountThreshold\r\n| mvexpand IPAddress\r\n| extend IPAddress = tostring(IPAddress)\r\n| extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName, IPCustomEntity = IPAddress \r\n};\r\nlet aadSignin = aadFunc(\"SigninLogs\");\r\nlet aadNonInt = aadFunc(\"AADNonInteractiveUserSignInLogs\");\r\nunion isfuzzy=true aadSignin, aadNonInt\r\n| summarize count() by UserPrincipalName, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èBrute Force Events by User",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Account Use Policies) Leverage Azure Policy for Account Use Policies\r\n![ImageName](https://techcommunity.microsoft.com/t5/image/serverpage/image-id/120046i5D3428FD31CE1F0F/image-size/large?v=v2&px=999)\r\n\r\n‚ú≥Ô∏è [Azure Policy](https://azure.microsoft.com/services/azure-policy/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Leverage Sentinel Hunting: Initial Access Filter",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityBaseline\r\n| where Description contains \"password\"\r\n| summarize count() by AnalyzeResult, ResourceId, Description\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Password Policies) Monitor Azure Password Policy Compliance with Security Baselines",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AnalyzeResult",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Passed",
                                "representation": "Resolved",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Failed",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"account\"\r\nor RecommendationDisplayName contains \"cred\"\r\nor RecommendationDisplayName contains \"IAM\"\r\nor RecommendationDisplayName contains \"identity\"\r\nor RecommendationDisplayName contains \"privilege\"\r\nor RecommendationDisplayName contains \"MFA\"\r\nor RecommendationDisplayName contains \"auth\"\r\nor RecommendationDisplayName contains \"password\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"network security group\"\r\nor RecommendationDisplayName contains \"management ports\"\r\nor RecommendationDisplayName contains \"owner\"\r\nor RecommendationDisplayName contains \"root\"\r\nor RecommendationDisplayName contains \"certificate\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management / Multi-Factor Authentication) Azure Security Center: Access & MFA Recommendations",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(User Account Management / Multi-Factor Authentication) Azure Security Center: Access & MFA Recommendations"
                }
              ]
            },
            "name": "Brute Force",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Forge Web Credentials (1606)](https://attack.mitre.org/techniques/T1606/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Web Cookies (T1606.001)](https://attack.mitre.org/techniques/T1606/001)<br> \r\nüü• Ô∏è[SAML tokens (T1606.002)](https://attack.mitre.org/techniques/T1606/002)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br>\r\nüü¶ [Software Configuration (M1054)](https://attack.mitre.org/mitigations/M1054)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Azure Security Logging and Auditing](https://docs.microsoft.com/azure/security/fundamentals/log-audit)<br>\r\nüí° [(Privileged Account Management) Deploy Azure AD Privileged Identity Management (PIM)](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-deployment-plan)<br>\r\nüí° [(Software Configuration) How to Create Azure Monitor Alerts for Non-Compliant Azure Policies](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-create-azure-monitor-alerts-for-non-compliant-azure/ba-p/713466)<br>\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "BehaviorAnalytics\r\n| where ActionType == \"Sign-in\"\r\n| join (\r\n    SigninLogs\r\n    )\r\n    on $left.SourceRecordId == $right._ItemId\r\n| extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n    UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n| where Location <> \"\"",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous Sign-ins by Geolocation",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "map",
                    "mapSettings": {
                      "locInfo": "CountryRegion",
                      "locInfoColumn": "Location",
                      "latitude": "SourceIPLocation",
                      "longitude": "SourceIPLocation",
                      "sizeSettings": "Location",
                      "sizeAggregation": "Count",
                      "legendMetric": "SourceIPLocation",
                      "legendAggregation": "Count",
                      "itemColorSettings": {
                        "nodeColorField": "SourceIPLocation",
                        "colorAggregation": "Count",
                        "type": "heatmap",
                        "heatmapPalette": "orangeRed"
                      }
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "BehaviorAnalytics\r\n| where ActionType == \"Sign-in\"\r\n| where UsersInsights.IsNewAccount == True or UsersInsights.IsDormantAccount == True or ActivityInsights has \"True\"\r\n| join (\r\n    SigninLogs\r\n    | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \"none\"\r\n    )\r\n    on $left.SourceRecordId == $right._ItemId\r\n| extend UserPrincipalName = iff(UserPrincipalName has \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n    UserName = iff(UserName has \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n| project TimeGenerated, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights\r\n| summarize count() by UserPrincipalName, AppDisplayName\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous Sign-in Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc \r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Identity == \"MS-PIM\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart \r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Privileged Account Management) Privileged Identity Management Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Software Configuration) Leverage Azure Policy for Software Configuration\r\n![ImageName](https://techcommunity.microsoft.com/t5/image/serverpage/image-id/120046i5D3428FD31CE1F0F/image-size/large?v=v2&px=999)\r\n\r\n‚ú≥Ô∏è [Azure Policy](https://azure.microsoft.com/services/azure-policy/)\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| sort by Activities desc\r\n| limit 250\r\n\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Forge Web Credentials",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Steal Application Access Token (1528)](https://attack.mitre.org/techniques/T1528/)\r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Microsoft Cloud App Security](https://www.microsoft.com/microsoft-365/enterprise-mobility-security/cloud-app-security) ‚ú≥Ô∏è [Microsoft Defender for Endpoint]( https://www.microsoft.com/microsoft-365/security/endpoint-defender) <br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Restrict Web-Based Content (M1021)](https://attack.mitre.org/mitigations/M1021)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Azure Security Logging and Auditing](https://docs.microsoft.com/azure/security/fundamentals/log-audit)<br>\r\nüí° [(Restrict Web-Based Content) Deploy Microsoft Defender for Endpoint](https://docs.microsoft.com/microsoft-365/security/defender-endpoint/deployment-phases)<br>\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\nüí° [(User Training) Leverage Microsoft Learn for Security Training](https://docs.microsoft.com/learn/browse/?terms=security%20threat)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let operations = dynamic(['Create role assignment']);\r\nBehaviorAnalytics\r\n| where ActionType in(operations)\r\n| where ActivityInsights contains \"True\"\r\n| project TimeGenerated, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous Activity Role Assignment",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"app\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAbnormal Application Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èAbnormal Application Activity",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc \r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (User Training) Leverage Microsoft Learn for Security Training\r\n![Image Name](https://docs.microsoft.com/learn/modules/intro-to-security-in-azure/media/1-heading.png  \"Microsoft Learn\") \r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Learn](https://docs.microsoft.com/learn/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"script\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict Web-Based Content) Script Blocks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Restrict Web-Based Content) Script Blocks",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Steal Application Access Token",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Steal Web Session Cookie (1539)](https://attack.mitre.org/techniques/T1539/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br> \r\n\r\n### Mitigations\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\nüü¶ [Software Configuration (M1054)](https://attack.mitre.org/mitigations/M1054)<br>\r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Software Configuration) How to Create Azure Monitor Alerts for Non-Compliant Azure Policies](https://techcommunity.microsoft.com/t5/itops-talk-blog/how-to-create-azure-monitor-alerts-for-non-compliant-azure/ba-p/713466)<br>\r\nüí° [(User Training) Leverage Microsoft Learn for Security Training](https://docs.microsoft.com/learn/browse/?terms=security%20threat)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> üîÄ [Azure Policy](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"token\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èToken Abuse",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èToken Abuse",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (User Training) Leverage Microsoft Learn for Security Training\r\n![Image Name](https://docs.microsoft.com/learn/modules/intro-to-security-in-azure/media/1-heading.png  \"Microsoft Learn\") \r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Learn](https://docs.microsoft.com/learn/)\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Multi-Factor Authentication) Configure Multi Factor Authentication\r\n![Image Name](https://docs.microsoft.com/azure/active-directory/authentication/media/tutorial-enable-azure-mfa/conditional-access-overview.png) \r\n\r\n‚ú≥Ô∏è [Enable Azure Active Directory Premium Trial](https://azure.microsoft.com/trial/get-started-active-directory/)\r\n\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Software Configuration) Leverage Azure Policy for Software Configuration\r\n![ImageName](https://techcommunity.microsoft.com/t5/image/serverpage/image-id/120046i5D3428FD31CE1F0F/image-size/large?v=v2&px=999)\r\n\r\n‚ú≥Ô∏è [Azure Policy](https://azure.microsoft.com/services/azure-policy/)\r\n\r\n\r\n"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Steal Web Session Cookie",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Unsecured Credentials (1552)](https://attack.mitre.org/techniques/T1552/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Credentials in Files (T1552.001)](https://attack.mitre.org/techniques/T1552/001)<br> \r\nüü• Ô∏è[Cloud Instance Metadata API (T1552.005)](https://attack.mitre.org/techniques/T1552/005)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [LAQueryLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/laquerylogs) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Active Directory Configuration (M1015)](https://attack.mitre.org/mitigations/M1015)<br>\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Encrypt Sensitive Information (M1041)](https://attack.mitre.org/mitigations/M1041)<br>\r\nüü¶ [Filter Network Traffic (M1037)](https://attack.mitre.org/mitigations/M1037)<br>\r\nüü¶ [Operating System Configuration (M1028)](https://attack.mitre.org/mitigations/M1028)<br>\r\nüü¶ [Password Policies (M1027)](https://attack.mitre.org/mitigations/M1027)<br>\r\nüü¶ [Privileged Account Management (M1026)](https://attack.mitre.org/mitigations/M1026)<br>\r\nüü¶ [Restrict File and Directory Permissions (M1022)](https://attack.mitre.org/mitigations/M1022)<br>\r\nüü¶ [Update Software (M1051)](https://attack.mitre.org/mitigations/M1051)<br>\r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Secure Credentials) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Secure Credentials) Secure Identity with Zero Trust](https://docs.microsoft.com/security/zero-trust/identity)<br> \r\nüí° [(Secure Credentials) Secure Secrets with Azure Key Vault](https://docs.microsoft.com/azure/key-vault/general/basic-concepts)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Key Vault](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.KeyVault%2Fvaults) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let keywords = dynamic([\"password\", \"pwd\", \"creds\", \"credentials\", \"secret\"]);\r\n  let table_exclusions = dynamic([\"AuditLogs\",\"SigninLogs\", \"LAQueryLogs\", \"SecurityEvent\"]);\r\n  let keyword_exclusion = dynamic([\"reset user password\", \"change user password\"]);\r\n  LAQueryLogs\r\n  | extend querytext_lower = tolower(QueryText)\r\n  | where querytext_lower has_any(keywords)\r\n  | project TimeGenerated, AADEmail, QueryText, RequestClientApp, RequestTarget, ResponseCode, ResponseRowCount, ResponseDurationMs, CorrelationId\r\n  | extend timestamp = TimeGenerated, AccountCustomEntity = AADEmail\r\n  | join kind=leftanti ( LAQueryLogs\r\n  | extend querytext_lower = tolower(QueryText)\r\n  | where QueryText has_any(table_exclusions) or querytext_lower has_any(keyword_exclusion))\r\n  on CorrelationId\r\n  | where AADEmail != \"\"\r\n  | summarize count() by AADEmail, RequestTarget, RequestClientApp, QueryText\r\n  | sort by count_ desc\r\n  | limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Searching for Secrets, Credentials, Passwords",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName == \"List Storage Account Keys\"\r\n| where ActivityStatus == \"Succeeded\" \r\n| join kind= inner (\r\n    AzureActivity\r\n    | where OperationName == \"List Storage Account Keys\"\r\n    | where ActivityStatus == \"Succeeded\" \r\n    | project ExpectedIpAddress=CallerIpAddress, Caller \r\n    | evaluate autocluster()\r\n    )\r\n    on Caller \r\n| where CallerIpAddress != ExpectedIpAddress\r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), ResourceIds = makeset(ResourceId), ResourceIdCount = dcount(ResourceId) by OperationName, Caller, CallerIpAddress\r\n| extend timestamp = StartTime, AccountCustomEntity = Caller, IPCustomEntity = CallerIpAddress\r\n| summarize count() by OperationName, Caller\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èStorage Key Enumeration",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "OperationName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Resources\r\n| join kind=leftouter (ResourceContainers | where type=='microsoft.resources/subscriptions' | project SubName=name, subscriptionId) on subscriptionId\r\n| where type == 'microsoft.keyvault/vaults'\r\n| project id, type, location, resourceGroup",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Secure Credentials) Leverage Azure Key Vault to Store Secrets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"MFA\"\r\nor RecommendationDisplayName contains \"auth\"\r\nor RecommendationDisplayName contains \"password\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"network security group\"\r\nor RecommendationDisplayName contains \"management ports\"\r\nor RecommendationDisplayName contains \"owner\"\r\nor RecommendationDisplayName contains \"root\"\r\nor RecommendationDisplayName contains \"certificate\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Secure Credentials) Azure Security Center: Recommendations for Credentials",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Secure Credentials) Azure Security Center: Recommendations for Credentials"
                }
              ]
            },
            "name": "Unsecured Credentials",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "CredentialAccess"
      },
      "name": "Credential Access Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Discovery](https://attack.mitre.org/tactics/TA0007/) \r\n---\r\nThe adversary is trying to figure out your environment. Discovery consists of techniques an adversary may use to gain knowledge about the system and internal network. These techniques help adversaries observe the environment and orient themselves before deciding how to act. They also allow adversaries to explore what they can control and what‚Äôs around their entry point in order to discover how it could benefit their current objective. Native operating system tools are often used toward this post-compromise information-gathering objective.\r\n"
            },
            "customWidth": "45",
            "name": "Discovery Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 13"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "8878ab5a-df41-4d6f-8366-6a7ce6c7c86d",
                  "cellValue": "Discovery Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "fdfc3ee3-d1b4-4517-a028-ccdbee32d2ba",
                  "cellValue": "Account Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Account Discovery",
                  "style": "link"
                },
                {
                  "id": "fc13f1d2-5476-473d-adb8-6a4370490ba6",
                  "cellValue": "Cloud Infrastructure Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Cloud Infrastructure Discovery",
                  "style": "link"
                },
                {
                  "id": "a6ad6b2d-665b-4871-9324-7f109a39fd32",
                  "cellValue": "Cloud Service Dashboard",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Cloud Service Dashboard",
                  "style": "link"
                },
                {
                  "id": "1fa0f432-8f11-482f-89e9-5d0642aadef8",
                  "cellValue": "Cloud Service Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Cloud Service Discovery",
                  "style": "link"
                },
                {
                  "id": "e8fde9f1-5ec4-41fc-a23d-8d8b7eaebb57",
                  "cellValue": "Network Service Scanning",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Network Service Scanning",
                  "style": "link"
                },
                {
                  "id": "75c52737-045e-4147-98a3-596576a5754f",
                  "cellValue": "Permission Groups Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Permission Groups Discovery",
                  "style": "link"
                },
                {
                  "id": "b1185b2c-2d8d-4c88-8381-047184354692",
                  "cellValue": "Software Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Software Discovery",
                  "style": "link"
                },
                {
                  "id": "06ad886e-b240-40ce-a3e1-e413ccaea0a3",
                  "cellValue": "System Information Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è System Information Discovery",
                  "style": "link"
                },
                {
                  "id": "f52a99d1-efb6-45b3-8e1b-9a26ff30adf0",
                  "cellValue": "System Location Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è System Location Discovery",
                  "style": "link"
                },
                {
                  "id": "672561a6-dbc0-4fd7-a8bf-48f5bc893d0b",
                  "cellValue": "System Network Connections Discovery",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è System Network Connections Discovery",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Discovery Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Discovery\" and AlertName <> \"Azure Firewall IDPS\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èDiscovery Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èDiscovery Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Discovery\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èDiscovery Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èDiscovery Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Discovery Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Account Discovery (1087)](https://attack.mitre.org/techniques/T1087/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Email Account (T1087.003)](https://attack.mitre.org/techniques/T1087/003)<br> \r\nüü• Ô∏è[Cloud Account (T1087.004)](https://attack.mitre.org/techniques/T1087/004)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [VMComputer](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmcomputer) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Mitigations\r\nüü¶ [Operating System Configuration (M1028)](https://attack.mitre.org/mitigations/M1028)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Operating System Configuration) Tutorial: Monitor Changes and Update a Windows Virtual Machine in Azure](https://docs.microsoft.com/azure/virtual-machines/windows/tutorial-config-management)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let ProcessCreationEvents=() {\r\n    let processEvents=SecurityEvent\r\n        | where EventID == 4688\r\n        | project TimeGenerated, ComputerName=Computer, AccountName=SubjectUserName, AccountDomain=SubjectDomainName,\r\n            FileName=tostring(split(NewProcessName, '\\\\')[-1]),\r\n            ProcessCommandLine = CommandLine, \r\n            FolderPath = \"\",\r\n            InitiatingProcessFileName=ParentProcessName, InitiatingProcessCommandLine=\"\", InitiatingProcessParentFileName=\"\";\r\n    processEvents\r\n};\r\nProcessCreationEvents\r\n| where FileName == 'net.exe' and AccountName != \"\" and ProcessCommandLine !contains '\\\\' and ProcessCommandLine !contains '/add' \r\n| where (ProcessCommandLine contains ' user ' or ProcessCommandLine contains ' group ') and (ProcessCommandLine endswith ' /do' or ProcessCommandLine endswith ' /domain') \r\n| extend Target = extract(\"(?i)[user|group] (\\\"*[a-zA-Z0-9-_ ]+\\\"*)\", 1, ProcessCommandLine)\r\n| filter Target != '' \r\n| summarize minTimeGenerated=min(TimeGenerated), maxTimeGenerated=max(TimeGenerated), count() by AccountName, Target, ProcessCommandLine, ComputerName\r\n| project minTimeGenerated, maxTimeGenerated, count_, AccountName, Target, ProcessCommandLine, ComputerName\r\n| sort by AccountName, Target\r\n| extend timestamp = minTimeGenerated, AccountCustomEntity = AccountName, HostCustomEntity = ComputerName\r\n| project AccountName, Target, ProcessCommandLine, minTimeGenerated\r\n| sort by minTimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èEnumeration of Users and Groups",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AccountName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMComputer \r\n| distinct _ResourceId, OperatingSystemFullName, AzureImageOffering, AzureImageSku, AzureSize\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Operating System Configuration) Monitor Operating System Configurations",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3"
                }
              ]
            },
            "name": "Account Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Cloud Infrastructure Discovery (1580)](https://attack.mitre.org/techniques/T1580/)\r\n\r\n### Recommended Logs\r\nüî∑ [LAQueryLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/laquerylogs) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Mitigations\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "LAQueryLogs\r\n| where TimeGenerated between(startofday(ago(1d))..startofday(ago(7d)))\r\n| summarize by AADEmail\r\n| join kind = rightanti (LAQueryLogs)\r\n    on AADEmail\r\n| project TimeGenerated, AADEmail, QueryText, RequestClientApp, RequestTarget\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = AADEmail\r\n| where AADEmail <> \"\"\r\n| summarize count() by AADEmail, RequestTarget\r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNew User Running Log Queries",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "orange"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Cloud Infrastructure Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Cloud Service Dashboard (1538)](https://attack.mitre.org/techniques/T1538/)\r\n\r\n### Recommended Logs\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/) <br>\r\n\r\n### Mitigations\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)  <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SigninLogs\r\n// 50126 - Invalid username or password, or invalid on-premises username or password.\r\n// 50020? - The user doesn't exist in the tenant.\r\n| where ResultType in (\"50126\", \"50020\")\r\n| extend OS = DeviceDetail.operatingSystem, Browser = DeviceDetail.browser\r\n| extend StatusCode = tostring(Status.errorCode), StatusDetails = tostring(Status.additionalDetails)\r\n| extend State = tostring(LocationDetails.state), City = tostring(LocationDetails.city)\r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), IPAddresses = makeset(IPAddress), DistinctIPCount = dcount(IPAddress), \r\n    makeset(OS), makeset(Browser), makeset(City), AttemptCount = count() \r\n    by UserDisplayName, UserPrincipalName, AppDisplayName, ResultType, ResultDescription, StatusCode, StatusDetails, Location, State\r\n| extend timestamp = StartTime, AccountCustomEntity = UserPrincipalName",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èFailed Atttempt to Access Microsoft Portal",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellowOrangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| sort by Activities desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by Caller\r\n| render timechart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Account Actions over Time",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 3 - Copy"
                }
              ]
            },
            "name": "Cloud Service Dashboard",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Cloud Service Discovery (1526)](https://attack.mitre.org/techniques/T1526/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>   "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics contains \"Discovery\" and AlertName <> \"Azure Firewall IDPS\"\r\n| where AlertName !contains \"account\"\r\n| where AlertName !contains \"user\" \r\n| where AlertName !contains \"group\"\r\n| where AlertName !contains \"network\"\r\n| where AlertName !contains \"port\"\r\n| where AlertName contains \"quer\" or AlertName contains \"recon\" or AlertName contains \"enumerat\" or AlertName contains \"lookup\" or AlertName contains \"discover\" or AlertName contains \"scan\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCloud Service Discovery ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èCloud Service Discovery ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Cloud Service Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Network Service Scanning (1046)](https://attack.mitre.org/techniques/T1046/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> üî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Firewall]( https://azure.microsoft.com/services/azure-firewall/) <br>\r\n\r\n### Mitigations\r\nüü¶ [Disable or Remove Feature or Program (M1042)](https://attack.mitre.org/mitigations/M1042)<br>\r\nüü¶ [Network Intrusion Prevention (M1031)](https://attack.mitre.org/mitigations/M1031)<br>\r\nüü¶ [Network Segmentation (M1030)](https://attack.mitre.org/mitigations/M1030)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Disable or Remove Feature or Program) Deploy Azure Security Center for Integrated Vulnerability Assessments](https://docs.microsoft.com/azure/security-center/deploy-vulnerability-assessment-vm)<br> \r\nüí° [(Network Intrusion Prevention) Leverage Azure Firewall for Network Intrusion Prevention](https://docs.microsoft.com/azure/firewall/premium-features#idpst)<br>\r\nüí° [(Network Segmentation) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [Firewall Policies](https://portal.azure.com/#blade/HubsExtension/BrowseResourceBlade/resourceType/Microsoft.Network%2FfirewallPolicies)"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics contains \"Discovery\" and AlertName <> \"Azure Firewall IDPS\"\r\n| where AlertName !contains \"account\"\r\n| where AlertName !contains \"user\" \r\n| where AlertName !contains \"group\"\r\n| where AlertName contains \"network\"\r\n    or AlertName contains \"scan\"\r\n    or AlertName contains \"port\" \r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNetwork Service Scanning",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èNetwork Service Scanning",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityNestedRecommendation \r\n| distinct AssessedResourceId, Description, RecommendationSeverity, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Disable or Remove Feature or Program) Azure Security Center Vulnerable Software",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "error",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where Category == \"AzureFirewallNetworkRule\"\r\n| where OperationName == \"AzureFirewallIDSLog\"\r\n| parse msg_s with * \"TCP request from \" Source \" to \" Destination \". Action: \" ActionTaken \". Rule: \" IDPSSig \". IDS: \" IDSMessage \". Priority: \" Priority \". Classification: \" Classification\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by OperationName\r\n| render areachart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Network Intrusion Detection) Azure Firewall: IPDS Actions",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Description",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "error",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "RecommendationSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "red"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"network\"\r\nor RecommendationDisplayName contains \"restricted\"\r\nor RecommendationDisplayName contains \"traffic\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"bound\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"VPC\"\r\nor RecommendationDisplayName contains \"load balance\"\r\nor RecommendationDisplayName contains \"IP address\"\r\nor RecommendationDisplayName contains \"public access\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Network Segmentation) Azure Security Center Recommendations for Network Segmentation",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Network Segmentation) Azure Security Center Recommendations for Network Segmentation"
                }
              ]
            },
            "name": "Network Service Scanning",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Permission Groups Discovery (1069)](https://attack.mitre.org/techniques/T1069/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Cloud Groups (T1069.003)](https://attack.mitre.org/techniques/T1069/003)<br>\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics contains \"Discovery\" and AlertName <> \"Azure Firewall IDPS\"\r\n| where AlertName contains \"permission\" or AlertName contains \"group\" or AlertName contains \"account\" \r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èPermission Groups Discovery",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èPermission Groups Discovery",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Permission Groups Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Software Discovery (T1518)](https://attack.mitre.org/techniques/T1518/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Security Software Discovery (T1518.001)](https://attack.mitre.org/techniques/T1518/001)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"process\" \r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSuspicious Process Discovery",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èSuspicious Process Discovery",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Software Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [System Information Discovery (T1082)](https://attack.mitre.org/techniques/T1082/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"Config\" \r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSystem Information Discovery",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èSystem Information Discovery",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "System Information Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [System Location Discovery (T1614)](https://attack.mitre.org/techniques/T1614/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"location\" or AlertName contains \"IP address\" or AlertName contains \"geo\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èLocation Reconnaissance or Abnormal Location",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èLocation Reconnaissance or Abnormal Location",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "System Location Discovery",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [System Network Connections Discovery (T1049)](https://attack.mitre.org/techniques/T1049/)\r\n\r\n### Recommended Logs\r\nüî∑ [DeviceEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/deviceevents) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DeviceEvents\r\n| where InitiatingProcessCommandLine contains \"net\" or InitiatingProcessCommandLine contains \"lsof\" or InitiatingProcessCommandLine contains \"who\"\r\n| summarize count() by InitiatingProcessFileName\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSystem Network Connections Discovery by Suspect Processes",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "InitiatingProcessFileName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        },
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "System Network Connections Discovery",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Discovery"
      },
      "name": "Discovery Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Lateral Movement](https://attack.mitre.org/tactics/TA0008/) \r\n---\r\nThe adversary is trying to move through your environment. Lateral Movement consists of techniques that adversaries use to enter and control remote systems on a network. Following through on their primary objective often requires exploring the network to find their target and subsequently gaining access to it. Reaching their objective often involves pivoting through multiple systems and accounts to gain. Adversaries might install their own remote access tools to accomplish Lateral Movement or use legitimate credentials with native network and operating system tools, which may be stealthier.\r\n"
            },
            "customWidth": "45",
            "name": "Lateral Movement Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 4"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "824152cc-8149-4df9-a1ff-446e1266af40",
                  "cellValue": "Lateral Movement Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "ed262d4c-4100-4dd0-bc6c-94bc58e9a33c",
                  "cellValue": "Internal Spearphishing",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Internal Spearphishing",
                  "style": "link"
                },
                {
                  "id": "7b5f1a73-1162-49c2-a89a-3a25982b8b29",
                  "cellValue": "Use Alternate Authentication Material",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Use Alternate Authentication Material (Check: Defense Evasion)",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Lateral Movement Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Lateral\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èLateral Movements Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èLateral Movement Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Lateral\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èLateral Movement Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èLateral Movement Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Lateral Movement Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Internal Spearphishing (T1534)](https://attack.mitre.org/techniques/T1534/)\r\n\r\n### Recommended Logs\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br>\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [DeviceProcessEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/deviceprocessevents) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [Event](https://docs.microsoft.com/azure/azure-monitor/reference/tables/event) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "OfficeActivity\r\n| where OfficeWorkload == \"Exchange\"\r\n| where UserType <> \"Regular\"\r\n| project UserId, UserType, OfficeWorkload, RecordType, Operation, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNon-Regular User Exchange Activity by Account",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "pending",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where AlertName contains \"phish\" or AlertName contains \"email\"\r\n// Add organization's internal domains to determine internal/external phishing\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSpearphishing ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èSpearphishing ",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AuditLogs\r\n| where Category =~ \"ApplicationManagement\"\r\n| where ActivityDisplayName has_any (\"Add delegated permission grant\", \"Add app role assignment to service principal\")\r\n| where Result =~ \"success\"\r\n| where tostring(InitiatedBy.user.userPrincipalName) has \"@\" or tostring(InitiatedBy.app.displayName) has \"@\"\r\n| extend props = parse_json(tostring(TargetResources[0].modifiedProperties))\r\n| mv-expand props\r\n| extend UserAgent = tostring(AdditionalDetails[0].value)\r\n| extend InitiatingUser = tostring(parse_json(tostring(InitiatedBy.user)).userPrincipalName)\r\n| extend UserIPAddress = tostring(parse_json(tostring(InitiatedBy.user)).ipAddress)\r\n| extend DisplayName = tostring(props.displayName)\r\n| extend Permissions = tostring(parse_json(tostring(props.newValue)))\r\n| where Permissions has_any (\"Mail.Read\", \"Mail.ReadWrite\")\r\n| extend PermissionsAddedTo = tostring(TargetResources[0].displayName)\r\n| extend Type = tostring(TargetResources[0].type)\r\n| project-away props\r\n| join kind=leftouter(\r\n    AuditLogs\r\n    | where ActivityDisplayName has \"Consent to application\"\r\n    | extend AppName = tostring(TargetResources[0].displayName)\r\n    | extend AppId = tostring(TargetResources[0].id)\r\n    | project AppName, AppId, CorrelationId)\r\n    on CorrelationId\r\n| project-reorder TimeGenerated, OperationName, InitiatingUser, UserIPAddress, UserAgent, PermissionsAddedTo, Permissions, AppName, AppId, CorrelationId\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = InitiatingUser, IPCustomEntity = UserIPAddress\r\n| project InitiatingUser, OperationName, PermissionsAddedTo, TimeGenerated",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èMail Read Permissions Granted to Application",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "InitiatingUser",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PermissionsAddedTo",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Keywords = dynamic([\"helpdesk\", \" alert\", \" suspicious\", \"fake\", \"malicious\", \"phishing\", \"spam\", \"do not click\", \"do not open\", \"hijacked\", \"Fatal\"]);\r\nOfficeActivity\r\n| where Operation =~ \"New-InboxRule\"\r\n| where Parameters has \"Deleted Items\" or Parameters has \"Junk Email\" \r\n| extend Events=todynamic(Parameters)\r\n| parse Events with * \"SubjectContainsWords\" SubjectContainsWords '}'*\r\n| parse Events with * \"BodyContainsWords\" BodyContainsWords '}'*\r\n| parse Events with * \"SubjectOrBodyContainsWords\" SubjectOrBodyContainsWords '}'*\r\n| where SubjectContainsWords has_any (Keywords)\r\n    or BodyContainsWords has_any (Keywords)\r\n    or SubjectOrBodyContainsWords has_any (Keywords)\r\n| extend ClientIPAddress = case(ClientIP has \".\", tostring(split(ClientIP, \":\")[0]), ClientIP has \"[\", tostring(trim_start(@'[[]', tostring(split(ClientIP, \"]\")[0]))), ClientIP)\r\n| extend Keyword = iff(isnotempty(SubjectContainsWords), SubjectContainsWords, (iff(isnotempty(BodyContainsWords), BodyContainsWords, SubjectOrBodyContainsWords)))\r\n| extend RuleDetail = case(OfficeObjectId contains '/', tostring(split(OfficeObjectId, '/')[-1]), tostring(split(OfficeObjectId, '\\\\')[-1]))\r\n| summarize count(), StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated) by Operation, UserId, ClientIPAddress, ResultStatus, Keyword, OriginatingServer, OfficeObjectId, RuleDetail\r\n| extend timestamp = StartTimeUtc, IPCustomEntity = ClientIPAddress, AccountCustomEntity = UserId, HostCustomEntity =  OriginatingServer",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSuspicious Inbox Rule",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let timeframe = {TimeRange:grain};\r\nlet cmdList = dynamic([\"Set-CASMailbox\", \"ActiveSyncAllowedDeviceIDs\", \"add\"]);\r\n(union isfuzzy=true\r\n    (\r\n    SecurityEvent\r\n    | where TimeGenerated >= ago(timeframe)\r\n    | where CommandLine has_all (cmdList)\r\n| project Type, TimeGenerated, Computer, Account, SubjectDomainName, SubjectUserName, Process, ParentProcessName, CommandLine\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = Account, HostCustomEntity = Computer\r\n),\r\n(\r\nDeviceProcessEvents\r\n| where TimeGenerated >= ago(timeframe)\r\n| where InitiatingProcessCommandLine has_all (cmdList)\r\n| project Type, TimeGenerated, DeviceName, AccountName, InitiatingProcessAccountDomain, InitiatingProcessAccountName, InitiatingProcessFileName, InitiatingProcessParentFileName, InitiatingProcessCommandLine\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = AccountName, HostCustomEntity = DeviceName\r\n),\r\n(\r\nEvent\r\n| where TimeGenerated > ago(timeframe)\r\n| where Source == \"Microsoft-Windows-Sysmon\"\r\n| where EventID == 1\r\n| extend EventData = parse_xml(EventData).DataItem.EventData.Data\r\n| mv-expand bagexpansion=array EventData\r\n| evaluate bag_unpack(EventData)\r\n| extend Key=tostring(['@Name']), Value=['#text']\r\n| evaluate pivot(Key, any(Value), TimeGenerated, Source, EventLog, Computer, EventLevel, EventLevelName, EventID, UserName, RenderedDescription, MG, ManagementGroupName, Type, _ResourceId)\r\n| where TimeGenerated >= ago(timeframe)\r\n| where CommandLine has_all (cmdList)\r\n| extend Type = strcat(Type, \": \", Source)\r\n| project Type, TimeGenerated, Computer, User, Process, ParentImage, CommandLine\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = User, HostCustomEntity = Computer\r\n)\r\n)",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏è Email Access via Active Sync",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 8",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Internal Spearphishing",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "LateralMovement"
      },
      "name": "Lateral Movement Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Collection](https://attack.mitre.org/tactics/TA0009/) \r\n---\r\nThe adversary is trying to gather data of interest to their goal. Collection consists of techniques adversaries may use to gather information and the sources information is collected from that are relevant to following through on the adversary's objectives. Frequently, the next goal after collecting data is to steal (exfiltrate) the data. Common target sources include various drive types, browsers, audio, video, and email. Common collection methods include capturing screenshots and keyboard input.\r\n"
            },
            "customWidth": "45",
            "name": "Collection Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 7"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "821e715c-a6f3-402d-ae05-9cfe582a78d4",
                  "cellValue": "Collection Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "6288d86f-0c7c-4963-897f-54a0861429af",
                  "cellValue": "Data from Cloud Storage Object",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Data from Cloud Storage Object",
                  "style": "link"
                },
                {
                  "id": "eabe7841-1015-4170-be48-deff1ac98754",
                  "cellValue": "Data from Information Repositories",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Data from Information Repositories",
                  "style": "link"
                },
                {
                  "id": "332b75a2-1694-4290-8c20-520eac188b50",
                  "cellValue": "Data Staged",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Data Staged",
                  "style": "link"
                },
                {
                  "id": "f47ad533-95c2-4edb-b4db-6873f984acbe",
                  "cellValue": "Email Collection",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Email Collection",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Collection Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Collection\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCollection Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èCollection Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Collection\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èCollection Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èCollection Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Collection Tactics",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Data from Cloud Storage Object (T1530)](https://attack.mitre.org/techniques/T1530/)\r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Encrypt Sensitive Information (M1041)](https://attack.mitre.org/mitigations/M1041)<br>\r\nüü¶ [Filter Network Traffic (M1037)](https://attack.mitre.org/mitigations/M1037)<br>\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\nüü¶ [Restrict File and Directory Permissions (M1022)](https://attack.mitre.org/mitigations/M1022)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Review Policy/Trust Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\nüí° [(Encrypt Sensitive Information) Azure Encryption Overview](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview)<br>\r\nüí° [(Filter Network Traffic) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Restrict File and Directory Permissions) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName == \"List Storage Account Keys\"\r\n| where ActivityStatus == \"Succeeded\" \r\n| join kind= inner (\r\n    AzureActivity\r\n    | where OperationName == \"List Storage Account Keys\"\r\n    | where ActivityStatus == \"Succeeded\" \r\n    | project ExpectedIpAddress=CallerIpAddress, Caller \r\n    | evaluate autocluster()\r\n    )\r\n    on Caller \r\n| where CallerIpAddress != ExpectedIpAddress\r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), ResourceIds = makeset(ResourceId), ResourceIdCount = dcount(ResourceId) by OperationName, Caller, CallerIpAddress\r\n| extend timestamp = StartTime, AccountCustomEntity = Caller, IPCustomEntity = CallerIpAddress",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAzure Storage Key Enumeration",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let operations = dynamic(['Export an existing database']);\r\nBehaviorAnalytics\r\n| where ActionType in(operations)\r\n| where ActivityInsights has \"True\"\r\n| project TimeGenerated, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous Data Access",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 9",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"encry\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Encrypt Sensitive Information) Azure Security Center: Encryption Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Encrypt Sensitive Information) Azure Security Center: Encryption Recommendations"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityRecommendation\r\n| where RecommendationName contains \"network\"\r\nor RecommendationName contains \"restricted\"\r\nor RecommendationName contains \"traffic\"\r\nor RecommendationName contains \"port\"\r\nor RecommendationName contains \"firewall\"\r\nor RecommendationName contains \"inbound\"\r\nor RecommendationName contains \"outbound\"\r\nor RecommendationName contains \"connection\"\r\nor RecommendationName contains \"link\"\r\nor RecommendationName contains \"VPC\"\r\nor RecommendationName contains \"load balance\"\r\nor RecommendationName contains \"IP address\"\r\nor RecommendationName contains \"public access\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by RecommendationName\r\n| render timechart ",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Filter Network Traffic) Azure Security Center Recommendations for Network Traffic",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Multi-Factor Authentication) Configure Multi Factor Authentication\r\n![Image Name](https://docs.microsoft.com/azure/active-directory/authentication/media/tutorial-enable-azure-mfa/conditional-access-overview.png) \r\n\r\n‚ú≥Ô∏è [Enable Azure Active Directory Premium Trial](https://azure.microsoft.com/trial/get-started-active-directory/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"file\"\r\nor RecommendationDisplayName contains \"access\"\r\nor RecommendationDisplayName contains \"directory\"\r\nor RecommendationDisplayName contains \"permiss\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Restrict File and Directory Permissions) Azure Security Center Recommendations for File/Directory Permissions",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Restrict File and Directory Permissions) Azure Security Center Recommendations for File/Directory Permissions"
                }
              ]
            },
            "name": "Data from Cloud Storage Object",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Data from Information Repositories (T1213)](https://attack.mitre.org/techniques/T1213/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Confluence (T1213.001)](https://attack.mitre.org/techniques/T1213/001)<br> \r\nüü• Ô∏è[Sharepoint(T1213.002)](https://attack.mitre.org/techniques/T1213/002)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [BehaviorAnalytics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/behavioranalytics) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [LAQueryLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/laquerylogs) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> \r\nüî∑ [AuditLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/auditlogs) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [SigninLogs](https://docs.microsoft.com/azure/azure-monitor/reference/tables/signinlogs) ‚ú≥Ô∏è [Azure Active Directory](https://azure.microsoft.com/services/active-directory/)<br>\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br>\r\nüü¶ [User Training (M1017)](https://attack.mitre.org/mitigations/M1017)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Azure Security Logging and Auditing](https://docs.microsoft.com/azure/security/fundamentals/log-audit)<br>\r\nüí° [(User Account Management) What are Azure AD access reviews?](https://docs.microsoft.com/azure/active-directory/governance/access-reviews-overview)<br> \r\nüí° [(User Training) Leverage Microsoft Learn for Security Training](https://docs.microsoft.com/learn/browse/?terms=security%20threat)<br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)  <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let AnomalousSigninActivity = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where (UsersInsights.NewAccount == True or UsersInsights.DormantAccount == True) and (\r\n        ActivityInsights.FirstTimeUserAccessedResource == True and ActivityInsights.ResourceUncommonlyAccessedAmongPeers == True\r\n        or ActivityInsights.FirstTimeUserUsedApp == True and ActivityInsights.AppUncommonlyUsedAmongPeers == False)\r\n    | join (\r\n        SigninLogs | where Status.errorCode == 0 or Status.errorCode == 0 and RiskDetail != \"none\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Successful Sign-in with one or more of the following indications: sign by new or recently dormant accounts and sign in with resource for the first time (while none of their peers did) or to an app for the first time (while none of their peers did) or performed by a user with Risk indicaiton from AAD\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet critical = dynamic(['9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3', 'c4e39bd9-1100-46d3-8c65-fb160da0071f', '158c047a-c907-4556-b7ef-446551a6b5f7', '62e90394-69f5-4237-9190-012177145e10', 'd29b2b05-8046-44ba-8758-1e26182fcf32', '729827e3-9c14-49f7-bb1b-9608f156bbb8', '966707d0-3269-4727-9be2-8c3a10f19b9d', '194ae4cb-b126-40b2-bd5b-6091b380977d', 'fe930be7-5e62-47db-91af-98c3a49a38b1']);\r\nlet high = dynamic(['cf1c38e5-3621-4004-a7cb-879624dced7c', '7495fdc4-34c4-4d15-a289-98788ce399fd', 'aaf43236-0c0d-4d5f-883a-6955382ac081', '3edaf663-341e-4475-9f94-5c398ef6c070', '7698a772-787b-4ac8-901f-60d6b08affd2', 'b1be1c3e-b65d-4f19-8427-f6fa0d97feb9', '9f06204d-73c1-4d4c-880a-6edb90606fd8', '29232cdf-9323-42fd-ade2-1d097af3e4de', 'be2f45a1-457d-42af-a067-6ec1fa63bc45', '7be44c8a-adaf-4e2a-84d6-ab2649e08a13', 'e8611ab8-c189-46e8-94e1-60213ab1f814']);\r\nlet AnomalousRoleAssignment = AuditLogs\r\n    | where TimeGenerated > ago(28d)\r\n    | where OperationName == \"Add member to role\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target = tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner (\r\n        BehaviorAnalytics\r\n        | where ActionType == \"Add member to role\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend AnomalyName = \"Anomalous Role Assignemt\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access.  The query below generates an output of all high Blast Radius users performing Add member to priveleged role, or ones that add users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let LogOns=materialize(\r\n    BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\");\r\nlet AnomalousResourceAccess = LogOns\r\n    | where ActionType == \"ResourceAccess\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous Resource Access\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversary may be trying to move through the environment. APT29 and APT32, for example, has used PtH & PtT techniques to lateral move around the network. The query below generates an output of all users performing an resource access (4624:3) to devices for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousRDPActivity = LogOns\r\n    | where ActionType == \"RemoteInteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | extend AnomalyName = \"Anomalous RDP Activity\",\r\n        Tactic = \"Lateral Movement\",\r\n        Technique = \"\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user. FIN10, for example, has used RDP to move laterally to systems in the victim environment. The query below generates an output of all users performing a remote interactive logon (4624:10) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousLogintoDevices = LogOns\r\n    | where ActionType == \"InteractiveLogon\"\r\n    | where ActivityInsights.FirstTimeUserLoggedOnToDevice == true\r\n    | where UsersInsights.DormantAccount == true or DevicesInsights.LocalAdmin == true\r\n    | extend AnomalyName = \"Anomalous Login To Devices\",\r\n        Tactic = \"Privilege Escalation\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access and privilege escalation. The query below generates an output of all administator users performing an interactive logon (4624:2) to a device for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousPasswordReset = BehaviorAnalytics\r\n    | where ActionType == \"Reset user password\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == \"True\"\r\n    | join (\r\n        AuditLogs\r\n        | where OperationName == \"Reset user password\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Password Reset\",\r\n        Tactic = \"Impact\",\r\n        Technique = \"Account Access Removal\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may interrupt availability of system and network resources by inhibiting access to accounts utilized by legitimate users. Accounts may be deleted, locked, or manipulated (ex: changed credentials) to remove access to accounts. LockerGoga, for example, has been observed changing account passwords and logging off current users. The query below generates an output of all users performing Reset user password for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalousGeoLocationLogon = BehaviorAnalytics\r\n    | where ActionType == \"Sign-in\"\r\n    | where ActivityInsights.FirstTimeUserConnectedFromCountry == True and (ActivityInsights.FirstTimeConnectionFromCountryObservedInTenant == True or ActivityInsights.CountryUncommonlyConnectedFromAmongPeers == True)\r\n    | join (\r\n        SigninLogs\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Successful Logon\",\r\n        Tactic = \"Initial Access\",\r\n        Technique = \"Valid Accounts\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may steal the credentials of a specific user or service account using Credential Access techniques or capture credentials earlier in their reconnaissance process through social engineering for means of gaining Initial Access. APT33, for example, has used valid accounts for initial access. The query below generates an output of successful Sign-in performed by a user from a new geo location he has never connected from before, and none of his peers as well.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousFailedLogon = BehaviorAnalytics\r\n    | where ActivityType == \"LogOn\"\r\n    | where UsersInsights.BlastRadius == \"High\"\r\n    | join (\r\n        SigninLogs  \r\n        | where Status.errorCode == 50126\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Failed Logon\",\r\n        Tactic = \"Credential Access\",\r\n        Technique = \"Brute Force\",\r\n        SubTechnique = \"Password Guessing\",\r\n        Description = \"Adversaries with no prior knowledge of legitimate credentials within the system or environment may guess passwords to attempt access to accounts. Emotet, for example, has been observed using a hard coded list of passwords to brute force user accounts. The query below generates an output of all users with 'High' BlastRadius that perform failed Sign-in:Invalid username or password.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"Evidence\"]=ActivityInsights, ResourceDisplayName, AppDisplayName, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; \r\nlet AnomalousAADAccountManipulation = AuditLogs\r\n    | where OperationName == \"Update user\"\r\n    | mv-expand AdditionalDetails\r\n    | where AdditionalDetails.key == \"UserPrincipalName\"\r\n    | mv-expand TargetResources\r\n    | extend RoleId = tostring(TargetResources.modifiedProperties[0].newValue)\r\n    | where isnotempty(RoleId) and RoleId in (critical, high)\r\n    | extend RoleName = tostring(TargetResources.modifiedProperties[1].newValue)\r\n    | where isnotempty(RoleName)\r\n    | extend TargetId = tostring(TargetResources.id)\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | join kind=inner ( \r\n        BehaviorAnalytics\r\n        | where ActionType == \"Update user\"\r\n        | where UsersInsights.BlasrRadius == \"High\" or ActivityInsights.FirstTimeUserPerformedAction == true\r\n        )\r\n        on $left._ItemId == $right.SourceRecordId\r\n    | extend UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName) \r\n    | extend AnomalyName = \"Anomalous Account Manipulation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Account Manipulation\",\r\n        SubTechnique = \"\",\r\n        Description = \"Adversaries may manipulate accounts to maintain access to victim systems. These actions include adding new accounts to high privilleged groups. Dragonfly 2.0, for example, added newly created accounts to the administrators group to maintain elevated access. The query below generates an output of all high Blast Radius users performing 'Update user' (name change) to priveleged role, or ones that changed users for the first time.\"\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, RoleName, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority; let AnomalousAADAccountCreation = BehaviorAnalytics\r\n    | where ActionType == \"Add user\"\r\n    | where ActivityInsights.FirstTimeUserPerformedAction == True or ActivityInsights.FirstTimeActionPerformedInTenant == True or ActivityInsights.ActionUncommonlyPerformedAmongPeers == true\r\n    | join(\r\n        AuditLogs\r\n        | where OperationName == \"Add user\"\r\n        )\r\n        on $left.SourceRecordId == $right._ItemId\r\n    | mv-expand TargetResources\r\n    | extend Target =  iff(tostring(TargetResources.userPrincipalName) contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(TargetResources.userPrincipalName, \"#\")[0])), TargetResources.userPrincipalName), tostring(TargetResources.userPrincipalName)\r\n    | extend DisplayName = tostring(UsersInsights.AccountDisplayName),\r\n        UserPrincipalName = iff(UserPrincipalName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserPrincipalName),\r\n        UserName = iff(UserName contains \"#EXT#\", replace(\"_\", \"@\", tostring(split(UserPrincipalName, \"#\")[0])), UserName)\r\n    | extend AnomalyName = \"Anomalous Account Creation\",\r\n        Tactic = \"Persistence\",\r\n        Technique = \"Create Account\",\r\n        SubTechnique = \"Cloud Account\",\r\n        Description = \"Adversaries may create a cloud account to maintain access to victim systems. With a sufficient level of access, such accounts may be used to establish secondary credentialed access that does not require persistent remote access tools to be deployed on the system. The query below generates an output of all the users performing user creation for the first time and the target users that were created.\"\t\r\n    | project TimeGenerated, AnomalyName, Tactic, Technique, SubTechnique, Description, UserName, UserPrincipalName, UsersInsights, ActivityType, ActionType, [\"TargetUser\"]=Target, [\"Evidence\"]=ActivityInsights, SourceIPAddress, SourceIPLocation, SourceDevice, DevicesInsights, [\"Anomaly Score\"]=InvestigationPriority\r\n    | sort by TimeGenerated desc;\r\nlet AnomalyTable = union kind=outer AnomalousSigninActivity, AnomalousRoleAssignment, AnomalousResourceAccess, AnomalousRDPActivity, AnomalousPasswordReset, AnomalousLogintoDevices, AnomalousGeoLocationLogon, AnomalousAADAccountManipulation, AnomalousAADAccountCreation, AnomalousFailedLogon;\r\nlet TopUsersByAnomalies = AnomalyTable\r\n    | summarize hint.strategy = shuffle AnomalyCount=count() by UserName, UserPrincipalName, tostring(UsersInsights.OnPremSid), tostring(UsersInsights.AccountObjectId)\r\n    | project Name=tolower(UserName), UPN=tolower(UserPrincipalName), AadUserId=UsersInsights_AccountObjectId, Sid=UsersInsights_OnPremSid, AnomalyCount\r\n    | sort by AnomalyCount desc;\r\nlet TopUsersByIncidents = SecurityIncident\r\n    | summarize hint.strategy = shuffle arg_max(LastModifiedTime, *) by IncidentNumber\r\n    | where Status == \"New\" or Status == \"Active\"\r\n    | mv-expand AlertIds\r\n    | extend AlertId = tostring(AlertIds)\r\n    | join kind= innerunique ( \r\n        SecurityAlert \r\n        )\r\n        on $left.AlertId == $right.SystemAlertId\r\n    | summarize hint.strategy = shuffle arg_max(TimeGenerated, *), NumberOfUpdates = count() by SystemAlertId\r\n    | mv-expand todynamic(Entities)\r\n    | where Entities[\"Type\"] =~ \"account\"\r\n    | extend Name = tostring(tolower(Entities[\"Name\"])), NTDomain = tostring(Entities[\"NTDomain\"]), UPNSuffix = tostring(Entities[\"UPNSuffix\"]), AadUserId = tostring(Entities[\"AadUserId\"]), AadTenantId = tostring(Entities[\"AadTenantId\"]), \r\n        Sid = tostring(Entities[\"Sid\"]), IsDomainJoined = tobool(Entities[\"IsDomainJoined\"]), Host = tostring(Entities[\"Host\"])\r\n    | extend UPN = iff(Name != \"\" and UPNSuffix != \"\", strcat(Name, \"@\", UPNSuffix), \"\")\r\n    | union TopUsersByAnomalies\r\n    | extend \r\n        AadPivot = iff(isempty(AadUserId), iff(isempty(Sid), Name, Sid), AadUserId),\r\n        SidPivot = iff(isempty(Sid), iff(isempty(AadUserId), Name, AadUserId), Sid),\r\n        UPNExists = iff(isempty(UPN), false, true),\r\n        NameExists = iff(isempty(Name), false, true),\r\n        SidExists = iff(isempty(Sid), false, true),\r\n        AADExists = iff(isempty(AadUserId), false, true)\r\n    | summarize hint.strategy = shuffle IncidentCount=dcount(IncidentNumber, 4), AlertCount=dcountif(AlertId, isnotempty(AlertId), 4), AnomalyCount=sum(AnomalyCount), any(Title, Severity, Status, StartTime, IncidentNumber, IncidentUrl, Owner), UPNAnchor=anyif(UPN, UPNExists == true), NameAnchor=anyif(Name, NameExists == true), AadAnchor=anyif(AadUserId, AADExists == true), SidAnchor=anyif(Sid, SidExists == true), any(SidPivot) by AadPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), NameAnchor=anyif(NameAnchor, isempty(NameAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_Title, any_Severity, any_StartTime, any_IncidentNumber, any_IncidentUrl) by any_SidPivot\r\n    | summarize hint.strategy = shuffle IncidentCount=sum(IncidentCount), AlertCount=sum(AlertCount), AnomalyCount=sum(AnomalyCount), UPNAnchor=anyif(UPNAnchor, isempty(UPNAnchor) == false), AadAnchor=anyif(AadAnchor, isempty(AadAnchor) == false), SidAnchor=anyif(SidAnchor, isempty(SidAnchor) == false), any(any_any_Title, any_any_Severity, any_any_StartTime, any_any_IncidentNumber, any_any_IncidentUrl) by NameAnchor\r\n    | project [\"UserName\"]=NameAnchor, IncidentCount, AlertCount, AnomalyCount, [\"AadUserId\"]=AadAnchor, [\"OnPremSid\"]=SidAnchor, [\"UserPrincipalName\"]=UPNAnchor;\r\nTopUsersByIncidents\r\n| sort by AlertCount desc\r\n| where UserName <> \"\"\r\n| project UserName, AlertCount, AnomalyCount\r\n| limit 100",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAnomalous User Activity",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore This Control Further and Implement Solutions                                                                                                                                               ‚Ä¢    Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Adjust the Time Paramenter for a Larger Data-Set                                                                                                                                                                          ‚Ä¢    Panels Can Display 'No Data' if All Recommendations are Fully Implemented, See Azure Security Center Recommendations                                                                                                                                   ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Pary Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserName",
                          "formatter": 16,
                          "formatOptions": {
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "AlertCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        },
                        {
                          "columnMatch": "AnomalyCount",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "yellow"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_AnomalyCount_2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_AnomalyCount_2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Extend this list with items to search for\r\nlet keywords = dynamic([\"password\", \"pwd\", \"creds\", \"credentials\", \"secret\"]);\r\n// To exclude key phrases or tables to exclude add to these lists\r\nlet table_exclusions = dynamic([\"AuditLogs\",\"SigninLogs\", \"LAQueryLogs\", \"SecurityEvent\"]);\r\nlet keyword_exclusion = dynamic([\"reset user password\", \"change user password\"]);\r\nLAQueryLogs\r\n| where RequestClientApp != 'Sentinel-General'\r\n| extend querytext_lower = tolower(QueryText)\r\n| where querytext_lower has_any(keywords)\r\n| project TimeGenerated, AADEmail, QueryText, RequestClientApp, RequestTarget, ResponseCode, ResponseRowCount, ResponseDurationMs, CorrelationId\r\n| extend timestamp = TimeGenerated, AccountCustomEntity = AADEmail\r\n| join kind=leftanti ( LAQueryLogs\r\n| where RequestClientApp != 'Sentinel-General'\r\n| extend querytext_lower = tolower(QueryText)\r\n| where QueryText has_any(table_exclusions) or querytext_lower has_any(keyword_exclusion))\r\non CorrelationId\r\n| distinct AADEmail, RequestTarget, RequestClientApp, QueryText, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Searching for Secrets",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AADEmail",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let lookback = {TimeRange:grain};\r\nlet timeframe = 1d;\r\nlet threshold = 0;\r\nLAQueryLogs\r\n| where TimeGenerated between (ago(lookback)..ago(timeframe))\r\n| mv-expand(RequestContext)\r\n| extend RequestContextExtended = split(RequestTarget, \"/\")\r\n| extend Subscription = tostring(RequestContextExtended[2]), ResourceGroups = tostring(RequestContextExtended[4]), Workspace = tostring(RequestContextExtended[8])\r\n| summarize count(), HistWorkspaceCount=dcount(Workspace) by AADEmail\r\n| join (\r\n    LAQueryLogs\r\n    | where TimeGenerated > ago(timeframe)\r\n    | mv-expand(RequestContext)\r\n    | extend RequestContextExtended = split(RequestTarget, \"/\")\r\n    | extend Subscription = tostring(RequestContextExtended[2]), ResourceGroups = tostring(RequestContextExtended[4]), Workspace = tostring(RequestContextExtended[8])\r\n    | summarize make_set(Workspace), count(), CurrWorkspaceCount=dcount(Workspace) by AADEmail\r\n    )\r\n    on AADEmail\r\n| where CurrWorkspaceCount > HistWorkspaceCount",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCross Workspace Query Anomolies",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize Activities = count() by User = Caller\r\n| where User <> \"\"\r\n| sort by Activities desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(User Account Management) Review Valid Accounts",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "User",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "resource",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Activities",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (User Training) Leverage Microsoft Learn for Security Training\r\n![Image Name](https://docs.microsoft.com/learn/modules/intro-to-security-in-azure/media/1-heading.png  \"Microsoft Learn\") \r\n\r\n‚ú≥Ô∏è [Get Started with Microsoft Learn](https://docs.microsoft.com/learn/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by OperationName, Caller\r\n| render barchart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6"
                }
              ]
            },
            "name": "Data from Information Repositories",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Data Staged (T1074)](https://attack.mitre.org/techniques/T1074/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Remote Data Staging (T1074.002)](https://attack.mitre.org/techniques/T1074/002)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityEvent](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> \r\nüî∑ [VMProcess](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmprocess) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "SecurityEvent\r\n| where EventID == 4688\r\n| extend CommandLine=tolower(CommandLine)\r\n| where CommandLine contains \"zip\" or CommandLine contains \"rar\" or CommandLine contains \"zlib\" or CommandLine contains \"compress\" or CommandLine contains \"encrypt\" or CommandLine contains \"cp\" or CommandLine contains \"copy\"\r\n| summarize count() by Process,Account \r\n| sort by count_ desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èUser Conducting Compress, Encrypt, or Copy from New Command Line Processes",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Process",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_count__2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_count__2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMProcess\r\n| where CommandLine contains \"zip\" or CommandLine contains \"rar\" or CommandLine contains \"zlib\" or CommandLine contains \"compress\" or CommandLine contains \"encrypt\" or CommandLine contains \"cp\" or CommandLine contains \"copy\" or CommandLine contains \"move\" or CommandLine contains \"transfer\"\r\n| project _ResourceId, InternalName, ExecutablePath, CommandLine, Type, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èAsset Conducting Compress, Encrypt, or Copy from Command Line Processes",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Process",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ],
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "VMProcess\r\n| where CommandLine contains \"zip\" or CommandLine contains \"rar\" or CommandLine contains \"zlib\" or CommandLine contains \"compress\" or CommandLine contains \"encrypt\" or CommandLine contains \"cp\" or CommandLine contains \"copy\" or CommandLine contains \"move\" or CommandLine contains \"transfer\"\r\n| summarize count() by ExecutableName\r\n| render piechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExecutable Conducting Compress, Encrypt, or Copy from Command Line Processes",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Process",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "uninitialized",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Account",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_heatmap_count__2",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_heatmap_count__2",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Data Staged",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Email Collection (T1114)](https://attack.mitre.org/techniques/T1114/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Remote Email Collection (T1114.002)](https://attack.mitre.org/techniques/T1114/002)<br> \r\nüü• Ô∏è[Email Forwarding Rule (T1114.003)](https://attack.mitre.org/techniques/T1114/003)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\n\r\n### Mitigations\r\nüü¶ [Audit (M1047)](https://attack.mitre.org/mitigations/M1047)<br>\r\nüü¶ [Encrypt Sensitive Information (M1041)](https://attack.mitre.org/mitigations/M1041)<br>\r\nüü¶ [Multi-factor Authentication (M1032)](https://attack.mitre.org/mitigations/M1032)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Audit) Review Policy/Trust Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\nüí° [(Encrypt Sensitive Information) Azure Encryption Overview](https://docs.microsoft.com/azure/security/fundamentals/encryption-overview)<br>\r\nüí° [(Multi-Factor Authentication) Review Your Security Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> üîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Azure Active Directory](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview)  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let starttime = {TimeRange:grain};\r\nlet endtime = 1d;\r\nlet historicalActivity=\r\n    OfficeActivity\r\n    | where TimeGenerated between(ago(starttime)..ago(endtime))\r\n    | where RecordType == \"ExchangeAdmin\" and UserType in (\"Admin\", \"DcAdmin\")\r\n    | summarize historicalCount=count() by UserId;\r\nlet recentActivity = OfficeActivity\r\n    | where TimeGenerated > ago(endtime)\r\n    | where UserType in (\"Admin\", \"DcAdmin\")\r\n    | summarize recentCount=count() by UserId;\r\nrecentActivity\r\n| join kind = leftanti (\r\n    historicalActivity\r\n    )\r\n    on UserId\r\n| project UserId, recentCount\r\n| order by recentCount asc, UserId\r\n| join kind = rightsemi \r\n    (OfficeActivity \r\n    | where TimeGenerated >= ago(endtime) \r\n    | where RecordType == \"ExchangeAdmin\"\r\n    | where UserType in (\"Admin\", \"DcAdmin\")) \r\n    on UserId\r\n| summarize StartTime = max(TimeGenerated), EndTime = min(TimeGenerated), count() by RecordType, Operation, UserType, UserId, OriginatingServer, ResultStatus\r\n| extend timestamp = StartTime, AccountCustomEntity = UserId\r\n| summarize count() by UserId\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNew Admin Account Activity Observed ",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "OfficeActivity\r\n| where Operation == \"MailboxLogin\" and Logon_Type != \"Owner\" \r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), count() by Operation, OrganizationName, UserType, UserId, MailboxOwnerUPN, Logon_Type, ClientIP\r\n| extend timestamp = StartTime, AccountCustomEntity = UserId, IPCustomEntity = ClientIP\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNon-Owner Accessing An Inbox",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "OfficeActivity\r\n| where Operation == \"MailboxLogin\"\r\n| where ClientInfoString == \"Client=Microsoft.Exchange.Powershell; Microsoft WinRM Client\"\r\n| summarize StartTime = min(TimeGenerated), EndTime = max(TimeGenerated), count() by Operation, OrganizationName, UserType, UserId, MailboxOwnerUPN, Logon_Type, ClientInfoString\r\n| extend timestamp = StartTime, AccountCustomEntity = UserId",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èPowerShell or Non-Browser Accessing An Inbox",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "OfficeActivity\r\n| where Operation =~ \"Set-Mailbox\"\r\n| where Parameters has \"ForwardingSmtpAddress\"\r\n| extend parsed = parse_json(Parameters)\r\n| mv-expand parsed\r\n| where parsed.Name == \"ForwardingSmtpAddress\"\r\n| extend parameterName = tostring(parsed.Name), fwdingDestination = tostring(parsed.Value)\r\n| where isnotempty(fwdingDestination)\r\n| extend ClientIPOnly = case( \r\n    ClientIP has \".\" and ClientIP has ':', tostring(split(ClientIP, \":\")[0]), \r\n    ClientIP has \".\" and ClientIP has '-', tostring(split(ClientIP, \"-\")[0]), \r\n    ClientIP has ']-', tostring(trim_start(@'[[]', tostring(split(ClientIP, \"]\")[0]))),\r\n    ClientIP has ']:', tostring(trim_start(@'[[]', tostring(split(ClientIP, \"]\")[0]))),\r\n    isempty(ClientIP) and ClientIP_ has \".\" and ClientIP_ has ':', tostring(split(ClientIP_, \":\")[0]), \r\n    isempty(ClientIP) and ClientIP_ has \".\" and ClientIP_ has '-', tostring(split(ClientIP_, \"-\")[0]), \r\n    isempty(ClientIP) and ClientIP_ has ']-', tostring(trim_start(@'[[]', tostring(split(ClientIP_, \"]\")[0]))),\r\n    isempty(ClientIP) and ClientIP_ has ']:', tostring(trim_start(@'[[]', tostring(split(ClientIP_, \"]\")[0]))),\r\n    isnotempty(ClientIP), ClientIP,\r\n    isnotempty(ClientIP_), ClientIP_,\r\n    \"IP Not Available\"\r\n    )  \r\n| extend Port = case(\r\n    ClientIP has \".\" and ClientIP has ':', tostring(split(ClientIP, \":\")[1]), \r\n    ClientIP has \".\" and ClientIP has '-', tostring(split(ClientIP, \"-\")[1]), \r\n    ClientIP has ']-', tostring(split(ClientIP, \"]-\")[1]), \r\n    ClientIP has ']:', tostring(split(ClientIP, \"]:\")[1]), \r\n    isempty(ClientIP) and ClientIP_ has \".\" and ClientIP_ has ':', tostring(split(ClientIP_, \":\")[1]), \r\n    isempty(ClientIP) and ClientIP_ has \".\" and ClientIP_ has '-', tostring(split(ClientIP_, \"-\")[1]), \r\n    isempty(ClientIP) and ClientIP_ has ']-', tostring(split(ClientIP_, \"]-\")[1]),\r\n    isempty(ClientIP) and ClientIP_ has ']:', tostring(split(ClientIP_, \"]:\")[1]),\r\n    isnotempty(ClientIP), ClientIP,\r\n    isnotempty(ClientIP_), ClientIP_,\r\n    \"IP Not Available\"\r\n    )\r\n| extend UserId = iff(isempty(UserId), UserId_, UserId)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), DistinctUserCount = dcount(UserId), UserId = make_set(UserId), \r\n    Ports = make_set(Port), EventCount = count()\r\n    by fwdingDestination, ClientIP = ClientIPOnly \r\n| where DistinctUserCount > 1\r\n| mv-expand UserId\r\n| extend UserId = tostring(UserId), Ports = tostring(Ports)\r\n| distinct StartTimeUtc, EndTimeUtc, UserId, DistinctUserCount, ClientIP, Ports, fwdingDestination, EventCount\r\n| extend timestamp = StartTimeUtc, AccountCustomEntity = UserId, IPCustomEntity = ClientIP",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èMultiple Users Email Forwarded to Same Destination",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "UserId",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 7",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| summarize count() by Caller, OperationName\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Audit) Monitor Audit Logs",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "info",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"encry\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Encrypt Sensitive Information) Azure Security Center: Encryption Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Encrypt Sensitive Information) Azure Security Center: Encryption Recommendations"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "### üü¶ (Multi-Factor Authentication) Configure Multi Factor Authentication\r\n![Image Name](https://docs.microsoft.com/azure/active-directory/authentication/media/tutorial-enable-azure-mfa/conditional-access-overview.png) \r\n\r\n‚ú≥Ô∏è [Enable Azure Active Directory Premium Trial](https://azure.microsoft.com/trial/get-started-active-directory/)"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                }
              ]
            },
            "name": "Email Collection",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Collection"
      },
      "name": "Collection Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Exfiltration](https://attack.mitre.org/tactics/TA0010/) \r\n---\r\nThe adversary is trying to steal data. Exfiltration consists of techniques that adversaries may use to steal data from your network. Once they‚Äôve collected data, adversaries often package it to avoid detection while removing it. This can include compression and encryption. Techniques for getting data out of a target network typically include transferring it over their command and control channel or an alternate channel and may also include putting size limits on the transmission."
            },
            "customWidth": "45",
            "name": "Exfiltration Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 4"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "056fb1a3-dc14-4661-b481-c36a3887c9a9",
                  "cellValue": "Exfiltration Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "061ab33b-4619-42e3-8187-f381a5e72465",
                  "cellValue": "Transfer Data to Cloud Account",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Transfer Data to Cloud Account",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Exfiltration Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"Exfiltration\" and AlertName <> \"Azure Firewall IDPS\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExfiltration Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èExfiltration Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"exfil\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èExfiltration Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èExfiltration Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Exfiltration Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Transfer Data to Cloud Account\r\nüü• Ô∏è[Transfer Data to Cloud Account (T1537)](https://attack.mitre.org/techniques/T1537/)\r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityalert) ‚ú≥Ô∏è [Azure Sentinel](https://azure.microsoft.com/services/azure-sentinel/) <br>\r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Filter Network Traffic (M1037)](https://attack.mitre.org/mitigations/M1037)<br> \r\nüü¶ [Password Policies (M1027)](https://attack.mitre.org/mitigations/M1027)<br> \r\nüü¶ [User Account Management (M1018)](https://attack.mitre.org/mitigations/M1018)<br> \r\n\r\n### Microsoft Recommendations\r\nüí° [(Filter Network Traffic) Review Traffic Recommendations](https://docs.microsoft.com/azure/security-center/security-center-recommendations)<br> \r\nüí° [(Password Policies) Rotate Storage Access Keys with Azure Key Vault](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\nüí° [(User Account Management) Review Access Recommendations](https://docs.microsoft.com/azure/storage/common/storage-account-keys-manage)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br>  üîÄ [GitHub](https://github.com/)"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where Tactics contains \"exfil\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èExfiltration Alerts (Azure Sentinel)",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èExfiltration Alerts (Azure Sentinel)",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n| where RecommendationDisplayName contains \"key\" or RecommendationDisplayName contains \"traffic\"\r\nor RecommendationDisplayName contains \"account\" or RecommendationDisplayName contains \"cred\" or RecommendationDisplayName contains \"IAM\" or RecommendationDisplayName contains \"identity\" or RecommendationDisplayName contains \"privilege\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Filter Network Traffic & Password Policies) Azure Security Center: Key/Traffic/Access Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Filter Network Traffic & Password Policies) Azure Security Center: Key/Traffic/Access Recommendations"
                }
              ]
            },
            "name": "Transfer Data to Cloud Account",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Exfiltration"
      },
      "name": "Exfiltration Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "#¬†[Impact](https://attack.mitre.org/tactics/TA0040/)\r\n---\r\nThe adversary is trying to manipulate, interrupt, or destroy your systems and data. Impact consists of techniques that adversaries use to disrupt availability or compromise integrity by manipulating business and operational processes. Techniques used for impact can include destroying or tampering with data. In some cases, business processes can look fine, but may have been altered to benefit the adversaries‚Äô goals. These techniques might be used by adversaries to follow through on their end goal or to provide cover for a confidentiality breach."
            },
            "customWidth": "45",
            "name": "Exfiltration Guide"
          },
          {
            "type": 1,
            "content": {
              "json": ""
            },
            "customWidth": "5",
            "name": "text - 9"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "8b9e2fb0-bcbd-4221-94ca-bd4685b08fe4",
                  "cellValue": "Impact Tactics",
                  "linkTarget": "step",
                  "linkLabel": "Techniques",
                  "style": "link"
                },
                {
                  "id": "1434997a-9721-4c0c-b9b5-240eabbda2e4",
                  "cellValue": "Data Destruction",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Data Destruction",
                  "style": "link"
                },
                {
                  "id": "b22b6d5c-4f01-4d7c-bcb3-08b8f7e7fda0",
                  "cellValue": "Data Encrypted for Impact",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Data Encrypted for Impact",
                  "style": "link"
                },
                {
                  "id": "44ea5a7a-91ea-4307-9bf5-e4c1bdb3c031",
                  "cellValue": "Defacement",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Defacement",
                  "style": "link"
                },
                {
                  "id": "e1191cf5-939c-402b-b594-9e38d53a82e7",
                  "cellValue": "Endpoint Denial of Service",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Endpoint Denial of Service",
                  "style": "link"
                },
                {
                  "id": "3476fa1c-20e5-4079-9c9f-298b155e714d",
                  "cellValue": "Network Denial of Service",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Network Denial of Service",
                  "style": "link"
                },
                {
                  "id": "68fd34b3-07a9-496d-bdb5-80ab362ea741",
                  "cellValue": "Resource Hijacking",
                  "linkTarget": "step",
                  "linkLabel": "‚ú≥Ô∏è Resource Hijacking",
                  "style": "link"
                }
              ]
            },
            "customWidth": "45",
            "name": "Impact Steps"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"impact\"\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by AlertName\r\n| render timechart",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èImpact Tactics: Security Alerts ",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "66",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èImpact Tactics: Security Alerts "
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, Product:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=inner SecurityProducts on ProviderName\r\n| where Product in ({Product}) or '{Product:label}' ==\"All\"\r\n| where Tactics contains \"impact\"\r\n| summarize count() by Product\r\n| sort by count_ desc",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏èImpact Tactics: Detecting Security Controls",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 0
                    },
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "count_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "33",
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏èImpact Tactics: Detecting Security Controls"
                }
              ]
            },
            "name": "Impact Tactics"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Data Destruction (T1485)](https://attack.mitre.org/techniques/T1485/)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [OfficeActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/officeactivity) ‚ú≥Ô∏è [Microsoft Defender for Office 365]( https://www.microsoft.com/microsoft-365/security/office-365-defender)<br> \r\nüî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Data Backup (M1053)](https://attack.mitre.org/mitigations/M1053)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Data Backup) What is the Azure Backup service?](https://docs.microsoft.com/azure/backup/backup-overview)<br>  \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"delete\" or OperationName contains \"remove\"\r\n| summarize count() by Caller, OperationName\r\n| sort by count_ desc\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èRemoving or Deleting Resources",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Adjust this value to change how many Teams should be deleted before including\r\nlet max_delete = 3;\r\nlet deleting_users = (\r\n    OfficeActivity\r\n    | where OfficeWorkload =~ \"MicrosoftTeams\"\r\n    | where Operation =~ \"TeamDeleted\"\r\n    | summarize count() by UserId\r\n    | where count_ > max_delete\r\n    | project UserId);\r\nOfficeActivity\r\n| where OfficeWorkload =~ \"MicrosoftTeams\"\r\n| where Operation =~ \"TeamDeleted\"\r\n| where UserId in (deleting_users)\r\n| make-series count() default=0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step 1d by UserId\r\n| render timechart\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èMultiple Teams Deleted by a Single User",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"back\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations"
                }
              ]
            },
            "name": "Data Destruction",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Data Encrypted for Impact (T1486)](https://attack.mitre.org/techniques/T1486/)\r\n\r\n### Recommended Logs\r\nüî∑ [VMConnection](https://docs.microsoft.com/azure/azure-monitor/reference/tables/vmconnection) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [DnsEvents](https://docs.microsoft.com/azure/azure-monitor/reference/tables/dnsevents) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Data Backup (M1053)](https://attack.mitre.org/mitigations/M1053)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Data Backup) What is the Azure Backup service?](https://docs.microsoft.com/azure/backup/backup-overview)<br>  \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br>"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let badDomains = dynamic([\"agrdwrtj.us\", \"bctxawdt.us\", \"cokfqwjmferc.us\", \"cxbenjiikmhjcerbj.us\", \"depuisgef.us\", \"edoknehyvbl.us\", \r\n    \"enyeikruptiukjorq.com\", \"frullndjtkojlu.us\", \"gcidpiuvamynj.us\", \"gxrytjoclpvv.us\", \"hanoluexjqcf.us\", \"iarirjjrnuornts.us\", \r\n    \"ifbjoosjqhaeqjjwaerri.us\", \"iouenviwrc.us\", \"kuuelejkfwk.us\", \"lkbsxkitgxttgaobxu.us\", \"nnnlafqfnrbynwor.us\", \"ns768.com\", \r\n    \"ofdwcjnko.us\", \"peuwdchnvn.us\", \"pvbeqjbqrslnkmashlsxb.us\", \"pxyhybnyv.us\", \"qkkftmpy.us\", \"rkhlkmpfpoqxmlqmkf.us\", \r\n    \"ryitsfeogisr.us\", \"srwcjdfrtnhnjekjerl.us\", \"thstlufnunxaksr.us\", \"udrgtaxgdyv.us\", \"w5q7spejg96n.com\", \"xmqlcikldft.us\", \r\n    \"yobvyjmjbsgdfqnh.us\", \"yrwgugricfklb.us\", \"ywpvqhlqnssecpdemq.us\"]);\r\nVMConnection\r\n| where RemoteDnsQuestions in~ (badDomains)\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), count() by Computer, SourceIp\r\n| extend timestamp = StartTimeUtc, HostCustomEntity = Computer, IPCustomEntity = SourceIp\r\n| summarize count() by Computer",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èWannaCry Ransomware Campaign Callbacks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "DnsEvents\r\n| join (ThreatIntelligenceIndicator\r\n    | summarize arg_max(TimeGenerated, *) by IndicatorId\r\n    | summarize by Url)\r\n    on $left.Name == $right.Url\r\n| summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), count()\r\n    by Computer, ClientIP, ThreatIntel_Related_Domain = Name, Url\r\n| extend timestamp = StartTimeUtc, HostCustomEntity = Computer, IPCustomEntity = ClientIP, URLCustomEntity = Url\r\n\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏è DNS Events Matching Threat Intelligence",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"back\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations"
                }
              ]
            },
            "name": "Data Encrypted for Impact",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Defacement (T1491)](https://attack.mitre.org/techniques/T1491/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[External Defacement (T1491.002)](https://attack.mitre.org/techniques/T1491/002)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure Web Application Firewall]( https://azure.microsoft.com/services/web-application-firewall/) <br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Data Backup (M1053)](https://attack.mitre.org/mitigations/M1053)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Data Backup) What is the Azure Backup service?](https://docs.microsoft.com/azure/backup/backup-overview)<br>  \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Backup Vaults](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyMenuBlade/Overview) <br> üîÄ [Web Application Firewall Policies](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FFrontDoorWebApplicationFirewallPolicies) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let FakeData = (datatable (Message: string, ruleName_s: string, clientIp_s: string, clientIP_s: string, action_s: string, transactionId_s: string, trackingReference_s: string) [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]);\r\nFakeData\r\n| union AzureDiagnostics\r\n| where (ResourceType == \"APPLICATIONGATEWAYS\" or ResourceType == \"FRONTDOORS\" or ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\") and (\"Application Gateway\" == \"All\" or (ResourceType == \"APPLICATIONGATEWAYS\" and \"Application Gateway\" contains \"application gateway\") or (ResourceType == \"FRONTDOORS\" and \"Application Gateway\" contains \"azure front door\") or (ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\" and \"Application Gateway\" contains \"cdn\")) and (\"SOC-NS-AG-WAFV2 - 1129440\" == \"All\" or Resource in ('SOC-NS-AG-WAFV2'))\r\n| where Category == \"FrontdoorWebApplicationFirewallLog\" or OperationName == \"ApplicationGatewayFirewall\" or Category == \"WebApplicationFirewallLogs\"\r\n| extend Action = iif(action_s == \"Blocked\", Action = \"Block\", action_s)\r\n| extend Action = iif(Action == \"Detected\", Action = \"Log\", Action)\r\n| where '*' == Action or '*' == \"*\" \r\n| where '*' == requestUri_s or '*' == \"*\"\r\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\r\n| extend Rule= iif(Rule contains \"Mandatory rule. Cannot be disabled.\", strcat_array(split(Rule, \"Mandatory rule. Cannot be disabled. Inbound \", 1), \"\"), Rule) // Removes initial component for mandatory rule \r\n| extend Rule = iif(Rule contains \"Total Inbound Score\", strcat_array(array_concat(split(Rule, \" - SQLI=\", 0), parse_json('[\") -\"]'), split(Rule, \"):\", 1)), \"\"), Rule) // Removes smaller information if more info is available for anomaly score\r\n| where Rule !contains \"sql\"\r\n| project Message, clientIp_s, action_s, ResourceId, Category, ResourceGroup, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èWeb Application Attacks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let FakeData = (datatable (Message: string, ruleName_s: string, clientIp_s: string, clientIP_s: string, action_s: string, transactionId_s: string, trackingReference_s: string) [\"\", \"\", \"\", \"\", \"\", \"\", \"\"]);\r\nFakeData\r\n| union AzureDiagnostics\r\n| where (ResourceType == \"APPLICATIONGATEWAYS\" or ResourceType == \"FRONTDOORS\" or ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\") and (\"Application Gateway\" == \"All\" or (ResourceType == \"APPLICATIONGATEWAYS\" and \"Application Gateway\" contains \"application gateway\") or (ResourceType == \"FRONTDOORS\" and \"Application Gateway\" contains \"azure front door\") or (ResourceType == \"CDNWEBAPPLICATIONFIREWALLPOLICIES\" and \"Application Gateway\" contains \"cdn\")) and (\"SOC-NS-AG-WAFV2 - 1129440\" == \"All\" or Resource in ('SOC-NS-AG-WAFV2'))\r\n| where Category == \"FrontdoorWebApplicationFirewallLog\" or OperationName == \"ApplicationGatewayFirewall\" or Category == \"WebApplicationFirewallLogs\"\r\n| extend Action = iif(action_s == \"Blocked\", Action = \"Block\", action_s)\r\n| extend Action = iif(Action == \"Detected\", Action = \"Log\", Action)\r\n| where '*' == Action or '*' == \"*\" \r\n| where '*' == requestUri_s or '*' == \"*\"\r\n| extend Rule = strcat(ruleName_s, Message), ClientIP = strcat(clientIp_s, clientIP_s)\r\n| extend Rule= iif(Rule contains \"Mandatory rule. Cannot be disabled.\", strcat_array(split(Rule, \"Mandatory rule. Cannot be disabled. Inbound \", 1), \"\"), Rule) // Removes initial component for mandatory rule \r\n| extend Rule = iif(Rule contains \"Total Inbound Score\", strcat_array(array_concat(split(Rule, \" - SQLI=\", 0), parse_json('[\") -\"]'), split(Rule, \"):\", 1)), \"\"), Rule) // Removes smaller information if more info is available for anomaly score\r\n| where Message contains \"sql \"\r\n| project Message, clientIp_s, action_s, ResourceId, Category, ResourceGroup, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èSQL Database Attacks",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Rule",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Fired",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "orangeRed"
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 6",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"back\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Data Backup) Azure Security Center: Backup Recommendations"
                }
              ]
            },
            "name": "Defacement",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Endpoint Denial of Service (T1499)](https://attack.mitre.org/techniques/T1499/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Service Exhaustion Flood (T1499.002)](https://attack.mitre.org/techniques/T1499/002)<br> \r\nüü• Ô∏è[Application Exhaustion Flood (T1499.003)](https://attack.mitre.org/techniques/T1499/003)<br> \r\nüü• Ô∏è[Application or System Exploitation (T1499.004)](https://attack.mitre.org/techniques/T1499/004)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [SecurityAlert](https://docs.microsoft.com/azure/azure-monitor/reference/tables/securityevent) ‚ú≥Ô∏è [Microsoft Defender for Endpoint](https://www.microsoft.com/microsoft-365/security/endpoint-defender)<br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Filter Network Traffic (M1037)](https://attack.mitre.org/mitigations/M1037)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Filter Network Traffic) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Microsoft 365 Security Center](https://security.microsoft.com/) <br> üîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br> üîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br> üîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SecurityProducts = datatable(ProviderName:string, shortName:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Azure Sentinel\",\r\n    \"MCAS\", \"Microsoft Cloud App Security\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\",\r\n    \"Azure Security Center\", \"Azure Security Center\",\r\n    \"Detection-WarmPathV2\", \"Azure Defender\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\",\r\n    \"IoTSecurity\", \"Azure Defender for IoT\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\",\r\n    \"AdaptiveNetworkHardenings\", \"ASC Adaptive Network Hardening\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\"\r\n];\r\nSecurityAlert\r\n| join kind=rightouter (SecurityProducts) on ProviderName\r\n| where ProviderName == \"MDATP\"\r\n| where Description contains \"denial\"\r\n| distinct AlertName, AlertSeverity, shortName, AlertLink, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èEndpoint Denial of Service",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "AlertName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertSeverity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AlertLink",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Alert >"
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "redBright"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü• Ô∏èEndpoint Denial of Service",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"network\"\r\nor RecommendationDisplayName contains \"restricted\"\r\nor RecommendationDisplayName contains \"traffic\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"inbound\"\r\nor RecommendationDisplayName contains \"outbound\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"VPC\"\r\nor RecommendationDisplayName contains \"load balance\"\r\nor RecommendationDisplayName contains \"IP address\"\r\nor RecommendationDisplayName contains \"public access\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Filter Network Traffic) Azure Security Center Recommendations for Network Traffic",
                    "noDataMessage": "No current ASB recommendations in this area. Confirm the Azure Security Benchmark Assessment is enabled in Azure Security Center: Regulatory Compliance blade.",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Filter Network Traffic) Azure Security Center Recommendations for Network Traffic"
                }
              ]
            },
            "name": "Endpoint Denial of Service",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# [Network Denial of Service (T1498)](https://attack.mitre.org/techniques/T1498/)\r\n\r\n### Sub-Techniques\r\nüü• Ô∏è[Direct Network Flood (T1498.001)](https://attack.mitre.org/techniques/T1498/001)<br> \r\nüü• Ô∏è[Reflection Amplification (T1498.002)](https://attack.mitre.org/techniques/T1498/002)<br> \r\n\r\n### Recommended Logs\r\nüî∑ [AzureDiagnostics](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azurediagnostics) ‚ú≥Ô∏è [Azure DDoS Protection]( https://azure.microsoft.com/services/ddos-protection/) <br> üî∑ [SecurityRecommendation](https://docs.microsoft.com/azure/defender-for-iot/how-to-security-data-access#security-recommendations) ‚ú≥Ô∏è [Azure Security Center](https://azure.microsoft.com/services/security-center/)<br> \r\n\r\n### Mitigations\r\nüü¶ [Filter Network Traffic (M1037)](https://attack.mitre.org/mitigations/M1037)<br>\r\n\r\n### Microsoft Recommendations\r\nüí° [(Filter Network Traffic) Leverage Network Security Groups](https://docs.microsoft.com/azure/virtual-network/manage-network-security-group)<br> \r\n\r\n### Microsoft Portals\r\nüîÄ [DDoS Protection Plans](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FddosProtectionPlans) <br> üîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  üîÄ [Azure Security Center](https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/0) <br> üîÄ [Network Security Groups](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FNetworkSecurityGroups) <br> üîÄ [Virtual Networks](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FvirtualNetworks) <br> üîÄ [Firewall Manager](https://portal.azure.com/#blade/Microsoft_Azure_HybridNetworking/FirewallManagerMenuBlade/firewallManagerOverview) <br> "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureDiagnostics\r\n| where ResourceType == \"PUBLICIPADDRESSES\"\r\n| where Category contains \"DoS\"\r\n| where Message <> \"\"\r\n| project Message, Category, TimeGenerated\r\n| sort by TimeGenerated desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èNetwork Denial of Service",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Message",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "2",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TotalPackets",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        },
                        {
                          "columnMatch": "TotalPacketsDropped",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "coldHot"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        },
                        {
                          "columnMatch": "Resource",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Total_packets_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "hotCold"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        },
                        {
                          "columnMatch": "Total_packets_dropped_",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "hotCold"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 4
                            }
                          }
                        }
                      ],
                      "filter": true
                    },
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "IPAddress",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        }
                      },
                      "subtitleContent": {
                        "columnMatch": "TopAttackVector",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "Resource"
                      },
                      "rightContent": {
                        "columnMatch": "TimeGenerated"
                      },
                      "showBorder": true,
                      "size": "auto"
                    }
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 4",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Regulatory compliance CSV report query for standard \"Azure Security Benchmark\" \r\n// Change the 'complianceStandardId' column condition to select a different standard\r\n    securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols/regulatorycomplianceassessments\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | where complianceStandardId ==  \"Azure Security Benchmark\"\r\n    | extend failedResources = toint(properties.failedResources), passedResources = toint(properties.passedResources),skippedResources = toint(properties.skippedResources)\r\n    | where failedResources + passedResources + skippedResources > 0\r\n    | join kind = leftouter(\r\n    securityresources\r\n    | where type == \"microsoft.security/assessments\") on subscriptionId, name\r\n    | extend complianceState = properties.state\r\n    | extend resourceSource = tolower(tostring(properties1.resourceDetails.Source))\r\n    | extend recommendationId = id1\r\n    | extend resourceId = trim(' ', tolower(tostring(case(resourceSource =~ 'azure', properties1.resourceDetails.Id,\r\n                                                        resourceSource =~ 'gcp', properties1.resourceDetails.GcpResourceId,\r\n                                                        resourceSource =~ 'aws', properties1.resourceDetails.AwsResourceId,\r\n                                                        extract('^(.+)/providers/Microsoft.Security/assessments/.+$',1,recommendationId)))))\r\n    | extend regexResourceId = extract_all(@\"/providers/[^/]+(?:/([^/]+)/[^/]+(?:/[^/]+/[^/]+)?)?/([^/]+)/([^/]+)$\", resourceId)[0]\r\n    | extend resourceType = iff(regexResourceId[1] != \"\", regexResourceId[1], iff(regexResourceId[0] != \"\", regexResourceId[0], \"subscriptions\"))\r\n    | extend resourceName = regexResourceId[2]\r\n    | extend recommendationName = name\r\n    | extend RecommendationDisplayName = properties1.displayName\r\n    | extend description = properties1.metadata.description\r\n    | extend remediationSteps = properties1.metadata.remediationDescription\r\n    | extend severity = properties1.metadata.severity\r\n    | extend state = properties1.status.code\r\n    | extend notApplicableReason = properties1.status.cause\r\n    | extend azurePortalRecommendationLink = properties1.links.azurePortal\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend complianceControlId = extract(@\"/regulatoryComplianceControls/([^/]*)\", 1, id)\r\n    | join kind = leftouter (securityresources\r\n    | where type == \"microsoft.security/regulatorycompliancestandards/regulatorycompliancecontrols\"\r\n    | extend complianceStandardId = replace( \"-\", \" \", extract(@'/regulatoryComplianceStandards/([^/]*)', 1, id))\r\n    | extend  controlName = tostring(properties.description)\r\n    | project controlId = name, controlName\r\n    | distinct  *) on $right.controlId == $left.complianceControlId\r\n\t| where RecommendationDisplayName contains \"network\"\r\nor RecommendationDisplayName contains \"restricted\"\r\nor RecommendationDisplayName contains \"traffic\"\r\nor RecommendationDisplayName contains \"port\"\r\nor RecommendationDisplayName contains \"firewall\"\r\nor RecommendationDisplayName contains \"inbound\"\r\nor RecommendationDisplayName contains \"outbound\"\r\nor RecommendationDisplayName contains \"connection\"\r\nor RecommendationDisplayName contains \"link\"\r\nor RecommendationDisplayName contains \"VPC\"\r\nor RecommendationDisplayName contains \"load balance\"\r\nor RecommendationDisplayName contains \"IP address\"\r\nor RecommendationDisplayName contains \"public access\"\r\n    | where state == \"Unhealthy\"\r\n    | extend Recommendation = strcat(\"https://\",azurePortalRecommendationLink), ResourceID = resourceId, ResourceType = resourceType, ResourceGroup = resourceGroup1, Severity = severity, State = state, ControlID = controlId\r\n    | project RecommendationDisplayName, ResourceID, ResourceType, ResourceGroup, Severity, State, ControlID, Recommendation\r\n    | limit 250",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü¶ Ô∏è(Filter Network Traffic) Azure Security Center Recommendations for Network Traffic",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "RecommendationDisplayName",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "warning",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Severity",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "ControlID",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 7,
                          "formatOptions": {
                            "linkTarget": "Url",
                            "linkLabel": "Go to Recommendation >"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Defend",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "üü¶ Ô∏è(Filter Network Traffic) Azure Security Center Recommendations for Network Traffic"
                }
              ]
            },
            "name": "Network Denial of Service",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Resource Hijacking\r\nüü• Ô∏è[Resource Hijacking (T1496)](https://attack.mitre.org/techniques/T1496/)\r\n\r\n### Recommended Logs\r\nüî∑ [AzureActivity](https://docs.microsoft.com/azure/azure-monitor/reference/tables/azureactivity) ‚ú≥Ô∏è [Azure Monitor]( https://azure.microsoft.com/services/monitor/) <br>\r\nüî∑ [Syslog](https://docs.microsoft.com/azure/azure-monitor/reference/tables/syslog) ‚ú≥Ô∏è [Collect Syslog Data Sources with Log Analytics Agent](https://docs.microsoft.com/azure/azure-monitor/agents/data-sources-syslog) <br> \r\n\r\n### Microsoft Portals\r\nüîÄ [Azure Sentinel](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel) <br>  "
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "// Extract EventType and EventData from AUOMS Syslog message\r\nSyslog\r\n| parse SyslogMessage with \"type=\" EventType \" audit(\" * \"): \" EventData\r\n| project TimeGenerated, EventType, Computer, EventData \r\n// Extract AUOMS_EXECVE details from EventData\r\n| where EventType =~ \"AUOMS_EXECVE\"\r\n| parse EventData with * \"syscall=\" syscall \" syscall_r=\" * \" success=\" success \" exit=\" exit \" a0\" * \" ppid=\" ppid \" pid=\" pid \" audit_user=\" audit_user \" auid=\" auid \" user=\" user \" uid=\" uid \" group=\" group \" gid=\" gid \"effective_user=\" effective_user \" euid=\" euid \" set_user=\" set_user \" suid=\" suid \" filesystem_user=\" filesystem_user \" fsuid=\" fsuid \" effective_group=\" effective_group \" egid=\" egid \" set_group=\" set_group \" sgid=\" sgid \" filesystem_group=\" filesystem_group \" fsgid=\" fsgid \" tty=\" tty \" ses=\" ses \" comm=\\\"\" comm \"\\\" exe=\\\"\" exe \"\\\"\" * \"cwd=\\\"\" cwd \"\\\"\" * \"name=\\\"\" name \"\\\"\" * \"cmdline=\\\"\" cmdline \"\\\" containerid=\" containerid\r\n// Find wget and curl commands\r\n| where comm in (\"wget\", \"curl\")\r\n// Find command lines featuring known crypto currency miner names\r\n| where cmdline contains \"nicehashminer\" or cmdline contains \"ethminer\" or cmdline contains \"equihash\" or cmdline contains \"NsCpuCNMiner64\" or cmdline contains \"minergate\" or cmdline contains \"minerd\" or cmdline contains \"cpuminer\" or cmdline contains \"xmr-stak-cpu\" or cmdline contains \"xmrig\" or cmdline contains \"stratum+tcp\" or cmdline contains \"cryptonight\" or cmdline contains \"monero\" or cmdline contains \"oceanhole\" or cmdline contains \"dockerminer\" or cmdline contains \"xmrdemo\"\r\n| project TimeGenerated, Computer, audit_user, user, cmdline",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCrypto Currency Miners",
                    "noDataMessage": "An Empty Panel Provides Opportunity To Explore Further and Implement Controls                                                                                                                                          ‚Ä¢    Controls: Confirm Licensing, Availability, and Health of Respective Offerings                                                                                                                                                ‚Ä¢    Logging: Confirm Log Source is Onboarded to Azure Sentinel Workspace                                                                                                                                                     ‚Ä¢    Time: Adjust the Time Parameter for a Larger Data-Set                                                                                                                                                                           ‚Ä¢    Hunting Alerts: Require Attack Traffic to Generate Results                                                                                                                                                             ‚Ä¢    Third Party Tooling: Adjust Respective Panel KQL Query for Third Party Tooling Requirements",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ]
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5",
                  "styleSettings": {
                    "maxWidth": "50"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "AzureActivity\r\n| where OperationName contains \"Create\"\r\n| where ActivityStatus == \"Succeeded\" \r\n| extend AccountCustomEntity = Caller\r\n| where Caller <> \"\"\r\n| summarize count() by Caller, CategoryValue, OperationName, ResourceId, ActivityStatus\r\n| sort by count_ desc\r\n| limit 250\r\n",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "üü• Ô∏èCreation of an Anomalous Number of Resources",
                    "timeContext": {
                      "durationMs": 5184000000
                    },
                    "timeContextFromParameter": "TimeRange",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Caller",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "1",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "count_",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Attack",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "query - 5"
                }
              ]
            },
            "name": "Resource Hijacking",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tactics",
        "comparison": "isEqualTo",
        "value": "Impact"
      },
      "name": "Impact Group"
    }
  ],
  "fromTemplateId": "sentinel-ThreatAnalysis&ResponseforCloud",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}