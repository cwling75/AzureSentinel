{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/vmwarecarbonblack_logo.svg\" width=\"75px\" height=\"75px\">\n\n**Important:** _This Azure Sentinel Solution is currently in public preview. This feature is provided without a service level agreement, and it's not recommended for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)._\n\n**Note:** _There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing._\n\n[VMWare Carbon Black](https://www.carbonblack.com/products/vmware-carbon-black-cloud-endpoint/) transforms your security with cloud native endpoint protection that adapts to your needs. VMWare Carbon Black provides an endpoint platform that helps you spot the minor fluctuations that hide malicious attacks and adapt prevention in response.\n\nAzure Sentinel Solutions provide a consolidated way to acquire Azure Sentinel content like data connectors, workbooks, analytics, and automations in your workspace with a single deployment step.\n\n**Workbooks:** 1, **Analytic Rules:** 2, **Custom Azure Logic Apps Connectors:** 1, **Playbooks:** 3\n\n[Learn more about Azure Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
        "subscription": {
          "resourceProviders": [
            "Microsoft.OperationsManagement/solutions",
            "Microsoft.OperationalInsights/workspaces/providers/alertRules",
            "Microsoft.Insights/workbooks"
          ]
        },
        "location": {
          "metadata": {
            "hidden": "Hiding location, we get it from the log analytics workspace"
          },
          "visible": false
        },
        "resourceGroup": {
          "allowExisting": true
        }
      }
    },
    "basics": [
      {
        "name": "getLAWorkspace",
        "type": "Microsoft.Solutions.ArmApiControl",
        "toolTip": "This filters by workspaces that exist in the Resource Group selected",
        "condition": "[greater(length(resourceGroup().name),0)]",
        "request": {
          "method": "GET",
          "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
        }
      },
      {
        "name": "workspace",
        "type": "Microsoft.Common.DropDown",
        "label": "Workspace",
        "placeholder": "Select a workspace",
        "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
        "constraints": {
          "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(filter.id, toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
          "required": true
        },
        "visible": true
      }
    ],
    "steps": [
      {
        "name": "analytics",
        "label": "Analytics",
        "subLabel": {
          "preValidation": "Configure the analytics",
          "postValidation": "Done"
        },
        "bladeTitle": "Analytics",
        "elements": [
          {
            "name": "analytics-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Azure Sentinel Solution installs analytic rules for VMWare Carbon Black that you can enable for custom alert generation in Azure Sentinel. These analytic rules will be deployed in disabled mode in the analytics rules gallery of your Azure Sentinel workspace. Configure and enable these rules in the analytic rules gallery after this Solution deploys.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-detect-threats-custom?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "analytic1",
            "type": "Microsoft.Common.Section",
            "label": "Critical Threat Detected",
            "elements": [
              {
                "name": "analytic1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This creates an incident in the event a critical threat was identified on a Carbon Black managed endpoint."
                }
              }
            ]
          },
          {
            "name": "analytic2",
            "type": "Microsoft.Common.Section",
            "label": "Known Malware Detected",
            "elements": [
              {
                "name": "analytic2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This creates an incident when a known Malware is detected on a endpoint managed by a Carbon Black."
                }
              }
            ]
          }
        ]
      },
      {
        "name": "workbooks",
        "label": "Workbooks",
        "subLabel": {
          "preValidation": "Configure the workbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Workbooks",
        "elements": [
          {
            "name": "workbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This Azure Sentinel Solution installs workbooks. Workbooks provide a flexible canvas for data monitoring, analysis and the creation of rich visual reports within the Azure portal. They allow you to tap into one or many data sources from Azure Sentinel and combine them into unified interactive experiences.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-monitor-your-data"
              }
            }
          },
          {
            "name": "workbook1",
            "type": "Microsoft.Common.Section",
            "label": "VMWare Carbon Black",
            "elements": [
              {
                "name": "workbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "Gain extensive insight into VMware Carbon Black Cloud - Endpoint Standard by analyzing, collecting and correlating Event logs. This workbook provides visibility into Carbon Black managed endpoints and identified threat events."
                }
              },
              {
                "name": "workbook1-name",
                "type": "Microsoft.Common.TextBox",
                "label": "Display Name",
                "defaultValue": "VMWare Carbon Black",
                "toolTip": "Display name for the workbook.",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter a workbook name"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "playbooks",
        "label": "Playbooks",
        "subLabel": {
          "preValidation": "Configure the playbooks",
          "postValidation": "Done"
        },
        "bladeTitle": "Playbooks",
        "elements": [
          {
            "name": "playbooks-text",
            "type": "Microsoft.Common.TextBlock",
            "options": {
              "text": "This solution installs playbook resources.  A security playbook is a collection of procedures that can be run from Azure Sentinel in response to an alert. A security playbook can help automate and orchestrate your response, and can be run manually or set to run automatically when specific alerts are triggered. Security playbooks in Azure Sentinel are based on Azure Logic Apps, which means that you get all the power, customizability, and built-in templates of Logic Apps. Each playbook is created for the specific subscription you choose, but when you look at the Playbooks page, you will see all the playbooks across any selected subscriptions.",
              "link": {
                "label": "Learn more",
                "uri": "https://docs.microsoft.com/azure/sentinel/tutorial-respond-threats-playbook?WT.mc_id=Portal-Microsoft_Azure_CreateUIDef"
              }
            }
          },
          {
            "name": "playbook1",
            "type": "Microsoft.Common.Section",
            "label": "CarbonBlackConnector",
            "elements": [
              {
                "name": "playbook1-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This connector is used to perform different actions on alerts, device and threats using CarbonBlack cloud endpoint API."
                }
              },
              {
                "name": "playbook1-CarbonBlack_CustomConnector_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Custom Connector Name",
                "defaultValue": "CarbonBlackConnector",
                "toolTip": "Please enter Custom Connector Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter Custom Connector Name"
                }
              },
              {
                "name": "playbook1-ServiceEndpoint",
                "type": "Microsoft.Common.TextBox",
                "label": "Service EndPoint",
                "defaultValue": "https://{CarbonblackBaseURL}",
                "toolTip": "Please enter the Carbon Black base URL",
                "constraints": {
                  "required": true,
                  "regex": "[\\w\\W]{1,256}$",
                  "validationMessage": "Please enter the Carbon Black base URL (ex: https://defense.conferdeploy.net)"
                }
              }
            ]
          },
          {
            "name": "playbook2",
            "type": "Microsoft.Common.Section",
            "label": "CarbonBlack-TakeDeviceActionFromTeams",
            "elements": [
              {
                "name": "playbook2-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook used to quarantine device or assigned policy via CarbonBlack connector."
                }
              },
              {
                "name": "playbook2-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CarbonBlack-TakeDeviceActionFromTeams",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              },
              {
                "name": "playbook2-OrganizationKey",
                "type": "Microsoft.Common.TextBox",
                "label": "Organization Key",
                "defaultValue": "OrganizationKey",
                "toolTip": "Please enter Organization Key",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Organization Key"
                }
              },
              {
                "name": "playbook2-PolicyId",
                "type": "Microsoft.Common.TextBox",
                "label": "Policy Id",
                "defaultValue": "0",
                "toolTip": "Please enter Policy Id",
                "constraints": {
                  "required": true,
                  "regex": "[0-9]{1,256}$",
                  "validationMessage": "Please enter the Policy Id"
                }
              },
              {
                "name": "playbook2-Teams_GroupId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams Group Id",
                "defaultValue": "TeamgroupId",
                "toolTip": "Please enter Teams Group Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter Teams Group Id"
                }
              },
              {
                "name": "playbook2-Teams_ChannelId",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams Channel Id",
                "defaultValue": "TeamChannelId",
                "toolTip": "Please enter Teams Channel Id",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter Teams Channel Id"
                }
              }
            ]
          },
          {
            "name": "playbook3",
            "type": "Microsoft.Common.Section",
            "label": "CarbonBlack-DeviceEnrichment",
            "elements": [
              {
                "name": "playbook3-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook used to enrich sentinel incident with device information."
                }
              },
              {
                "name": "playbook3-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CarbonBlack-DeviceEnrichment",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              }
            ]
          },
          {
            "name": "playbook4",
            "type": "Microsoft.Common.Section",
            "label": "CarbonBlack-QuarantineDevice",
            "elements": [
              {
                "name": "playbook4-text",
                "type": "Microsoft.Common.TextBlock",
                "options": {
                  "text": "This playbook automatically quarantine the device and enrich sentinel incident with device information."
                }
              },
              {
                "name": "playbook4-Playbook_Name",
                "type": "Microsoft.Common.TextBox",
                "label": "Playbook Name",
                "defaultValue": "CarbonBlack-QuarantineDevice",
                "toolTip": "Please enter Playbook Name",
                "constraints": {
                  "required": true,
                  "regex": "[a-z0-9A-Z]{1,256}$",
                  "validationMessage": "Please enter the Playbook Name"
                }
              }
            ]
          }
        ]
      }
    ],
    "outputs": {
      "workspace-location": "[resourceGroup().location]",
      "location": "[location()]",
      "workspace": "[basics('workspace')]",
      "workbook1-name": "[steps('workbooks').workbook1.workbook1-name]",
      "CarbonBlack_CustomConnector_Name": "[steps('playbooks').playbook1.playbook1-CarbonBlack_CustomConnector_Name]",
      "Service EndPoint": "[steps('playbooks').playbook1.playbook1-ServiceEndpoint]",
      "CarbonBlack-TakeDeviceActionFromTeams_Playbook_Name": "[steps('playbooks').playbook2.playbook2-Playbook_Name]",
      "CarbonBlack-DeviceEnrichment_Playbook_Name": "[steps('playbooks').playbook3.playbook3-Playbook_Name]",
      "CarbonBlack-QuarantineDevice_Playbook_Name": "[steps('playbooks').playbook4.playbook4-Playbook_Name]",
      "OrganizationKey": "[steps('playbooks').playbook2.playbook2-OrganizationKey]",
      "PolicyId": "[steps('playbooks').playbook2.playbook2-PolicyId]",
      "Teams_GroupId": "[steps('playbooks').playbook2.playbook2-Teams_GroupId]",
      "Teams_ChannelId": "[steps('playbooks').playbook2.playbook2-Teams_ChannelId]"
    }
  }
}
